\chapter{Build Facility}
\label{chap:Build Facility}
\index{Build Facility}

Janet Anderson is the author of this chapter.

\section{Overview}

This chapter describes the EPICS build facility including directory structure, environment and system requirements, 
configuration files, Makefiles, and related build tools. 

\subsection{\textless{}top\textgreater{} Directory structure}

\index{top}
\index{Directory structure}
EPICS software can be divided into multiple \verb|<top>| areas. Examples of \verb|<top>| areas are EPICS base itself, EPICS 
extensions, and simple or complicated IOC applications. Each \verb|<top>| may be maintained separately. Different \verb|<top>| areas 
can be on different releases of external software such as EPICS base releases.

A \verb|<top>| directory has the following directory structure:

\begin{verbatim}
        <top>/
            Makefile
            configure/
            dir1/
            dir2/
            ...
\end{verbatim}

where \verb|configure| is a directory containing build configuration files and a \verb|Makefile|, where \verb|dir1|, \verb|dir2|, ... are user created 
subdirectory trees with \verb|Makefile|s and source files to be built. Because the build rules allow make commands like
``\verb|make install.vxWorks-68040|", subdirectory names within a \verb|<top>| directory structure may not contain a period "\verb|.|" character.

\subsection{Install Directories}

\index{Install Directories}
Files installed during the build are installed into subdirectories of an installation directory which defaults to \verb|$(TOP)|, the 
\verb|<top>| directory. For base, extensions, and IOC applications,  the default value can be changed in the \\
\verb|configure/CONFIG_SITE|
file. The installation directory for the EPICS components is controlled by the definition of \index{INSTALL\_LOCATION}\verb|INSTALL_LOCATION|

The following subdirectories may exist in the installation directory. They are created by the build and contain the installed 
build components.

\begin{itemize}
\item \index{dbd directory}\verb|dbd| -- Directory into which Database Definition files are installed.

\item \index{include directory}\verb|include| -- The directory into which C header files are installed. These header files may be generated from menu and 
record type definitions.

\item \index{bin directory}\verb|bin| -- This directory contains a subdirectory for each host architecture and for each target architecture. These are the 
directories into which executables, binaries, etc. are installed.

\item \index{lib directory}\verb|lib| -- This directory contains a subdirectory for each host architecture. These are the directories into which libraries 
are installed.

\item \index{db directory}\verb|db| -- This is the directory into which database record instance, template, and substitution files are installed.

\item \index{html directory}\verb|html| -- This is the directory into which html documentation is installed.

\item \index{templates directory}\verb|templates| -- This is the directory into which template files are installed.

\item \index{javalib directory}\verb|javalib| -- This is the directory into which java class files and jar files are installed.

\item \index{configure directory}\verb|configure| -- The directory into which configure files are installed (if \verb|INSTALL_LOCATION| does not equal \verb|TOP|).

\item \index{cfg directory}\verb|cfg| -- The directory into which user created configure files are installed 
\end{itemize}

\subsection{Elements of build system}

\index{Elements of build system}
The main ingredients of the build system are:

\begin{itemize}
\item A set of configuration files and tools provided in the EPICS \verb|base/configure| directory

\item A corresponding set of configuration files in the \verb|<top>/configure| directory of a non-base \verb|<top>| directory structure
to be built. The makeBaseApp.pl and makeBaseExt.pl scripts create these configuration files. Many of these files
just include a file of the same name from the \verb|base/configure| directory.

\item Makefiles in each directory of the \verb|<top>| directory structure to be built

\item User created configuration files in build created \verb|$(INSTALL_LOCATION)/cfg| directories.
\end{itemize}

\subsection{Features}

\index{Features of build system}
The principal features of the build system are:

\begin{itemize}
\item Requires a single \verb|Makefile| in each directory of a \verb|<top>| directory structure

\item Supports both host os vendor's native compiler and GNU compiler

\item Supports building multiple types of software (libraries, executables, databases, java class files, etc.) stored in a 
single directory tree.

\item Supports building EPICS base, extensions, and IOC applications.

\item Supports multiple host and target operating system + architecture combinations.

\item Allows builds for all hosts and targets within a single \verb|<top>| source directory tree.

\item Allows sharing of components such as special record/device/drivers across \verb|<top>| areas.

\item gnumake is the only command used to build a \verb|<top>| area.
\end{itemize}

\subsection{Multiple host and target systems}

\index{Multiple host}
You can build on multiple host systems and for multiple \index{cross target}cross target systems using a single EPICS directory structure. 
The intermediate and binary files generated by the build will be created in separate O.* subdirectories and installed into 
the appropriate separate host or target install directories. EPICS executables and scripts are installed into the 
\verb|$(INSTALL_LOCATION)/bin/<arch>| directories. Libraries are installed into \verb|$(INSTALL_LOCATION)/lib/<arch>|. The 
default definition for \verb|$(INSTALL_LOCATION)| is \verb|$(TOP)| which is the root directory in the directory structure. 
Architecture dependant created files (e.g. object files) are stored in \verb|O.<arch>| source subdirectories, and architecture 
independent created files are stored in \verb|O.Common| source subdirectories. This allows objects for multiple cross target 
architectures to be maintained at the same time. 

To build EPICS base for a specific host/target combination you must have the proper host/target c/c++ cross compiler and 
target header files, \index{CROSS\_COMPILER\_HOST\_ARCHS}CROSS\_COMPILER\_HOST\_ARCHS must empty or include the host architecture in its list value, the 
\index{CROSS\_COMPILER\_TARGET\_ARCHS}\verb|CROSS_COMPILER_TARGET_ARCHS| variable must include the target to be cross-compiled, and the base/configure/
os directory must have the appropriate configure files.

\section{Build Requirements}

\index{Build Requirements}
\subsection{Host Environment Variable}

\index{Environment Prerequisites}
Only one environment variable, \verb|EPICS_HOST_ARCH|, is required to build EPICS \verb|<top>| areas. This variable should be 
set to be your workstation's operating system - architecture combination to use the os vendor's c/c++ compiler for native 
builds or set to the operating system - architecture - alternate compiler combination to use an alternate compiler for native 
builds if an alternate compiler is supported on your system. The filenames of the \verb|CONFIG.*.Common| files in base/
configure/os show the currently supported \index{EPICS\_HOST\_ARCH}\verb|EPICS_HOST_ARCH| values. Examples are \verb|solaris-sparc|, \verb|solaris-sparc-gnu|, \verb|linux-x86|, \verb|win32-x86|, and \verb|cygwin-x86|. 

\subsection{Software Prerequisites}

\index{Build software prerequisites}
Before you can build EPICS components your host system must have the following software installed: 

\begin{itemize}
\item \index{Perl}Perl version 5.8 or greater

\item \index{GNU make}GNU make, version 3.81 or greater

\item C++ compiler (host operating system vendor's compiler or GNU compiler)
\end{itemize}

If you will be building EPICS components for \index{vxWorks}vxWorks targets you will also need:

\begin{itemize}
\item \index{Tornado}Tornado II or vxWorks 6.x and one or more board support packages. Consult the vxWorks documentation for details.

\end{itemize}

If you will be building EPICS components for \index{vxWorks}RTEMS targets you will also need:

\begin{itemize}
\item \index{RTEMS}RTEMS development tools and libraries required to run EPICS IOC applications.

\end{itemize}

\subsection{Path requirements}

\index{Path requirements}
You must have the perl executable in your path and you may need C and C++ compilers in your search path. Check 
definitions of \verb|CC| and \verb|CCC| in \verb|base/configure/os/CONFIG.<host>.<host>| or the definitions for \verb|GCC| and \verb|G++| if 
\verb|ANSI=GCC| and \verb|CPLUSPLUS=GCC| are specified in \verb|CONFIG_SITE|. For building base you also must have echo in your 
search path. You can \index{override}override the default settings by defining PERL, CC and CCC, GCC and G++, GNU\_DIR ... in the 
appropriate file (usually \verb|configure/os/CONFIG_SITE.$EPICS_HOST_ARCH.Common|)

\subsubsection{Unix path}

For Unix host builds you also need touch, cpp, cp, rm, mv, and mkdir in your search path and /bin/chmod must exist. On 
some Unix systems you may also need ar and ranlib in your path, and the c compiler may require ld in your path.

\subsubsection{Win32 PATH}

On WIN32 systems, building shared libraries is the default setting and you will need to add fullpathname to 
\verb|$(INSTALL_LOCATION)/bin/$(EPICS_HOST_ARCH)| to your path so the shared libraries, dlls, can be found during 
the build.. Building shared libraries is determined by the value of the macro \index{SHARED\_LIBRARIES}\verb|SHARED_LIBRARIES| in \verb|CONFIG_SITE| or 
\verb|os/CONFIG.Common.<host>| (either \verb|YES| or \verb|NO|).

\subsection{Directory names}

\index{Directory names restriction}
Because the build rules allow make commands like ``\verb|make <dir>.<action>,<arch>|", subdirectory names within a \verb|<top>| 
directory structure may not contain a period"." character.

\subsection{EPICS\_HOST\_ARCH environment variable}

\index{EPICS\_HOST\_ARCH}
The startup directory in EPICS base contains a perl script, \index{EpicsHostArch.pl}\verb|EpicsHostArch.pl|, which can be used to define 
\verb|EPICS_HOST_ARCH|. This script can be invoked with a command line parameter defining the alternate compiler (e.g. if 
invoking \verb|EpicsHostArch.pl| yields \verb|solaris-sparc|, then invoking \verb|EpicsHostArch.pl gnu| will yield \verb|solaris-sparc-gnu|).

The startup directory also contains scripts to help users set the path and other environment variables.

\section{Configuration Definitions}

\subsection{Site-specific EPICS Base Configuration}

\index{Site specific Configuration}
\subsubsection{Site configuration}

To configure EPICS base for your site, you may want to modify the default definitions in the following files:

\begin{description}
\item \index{CONFIG\_SITE}\verb|configure/CONFIG_SITE| Build choices. Specify target archs.

\item \index{CONFIG\_SITE\_ENV}\verb|configure/CONFIG_SITE_ENV| Environment variable defaults

\end{description}

\subsubsection{Host configuration}

To configure each host system for your site, you may \index{override}override the default definitions in the \verb|configure/os| directory by 
adding a new file with override definitions. The new file should have the same name as the distribution file to be 
overridden except CONFIG in the name is changed to CONFIG\_SITE.

\begin{description}
\item \index{CONFIG\_SITE.host.host}\verb|configure/os/CONFIG_SITE.<host>.<host>| - Host build settings

\item \index{CONFIG\_SITE.host.Common}\verb|configure/os/CONFIG_SITE.<host>.Common| - Host build settings for all target systems

\end{description}

\subsubsection{Target configuration}

To configure each target system, you may \index{override}override the default definitions in the \verb|configure/os| directory by adding a new 
file with override definitions. The new file should have the same name as the distribution file to be overridden except 
\verb|CONFIG| in the name is replaced by \verb|CONFIG_SITE|.

\begin{description}
\item \index{CONFIG\_SITE.Common.target} \verb|configure/os/CONFIG_SITE.Common.<target>| - Target cross settings

\item \index{CONFIG\_SITE.host.target} \verb|configure/os/CONFIG_SITE.<host>.<target>| - Host-target settings

\item \index{CONFIG\_SITE.Common.vxWorksCommon} \verb|configure/os/CONFIG_SITE.Common.vxWorksCommon| - vxWorks full paths

\end{description}

\subsubsection{R3.13 compatibility configuration}

\index{compatibility configuration}
To configure EPICS base for building with R3.13 extensions and ioc applications, you must modify the default definitions 
in the base/config/CONFIG\_SITE* files to agree with site definitions you made in base/configure and base/configure/os 
files.You must also modify the following tow macros in the base/configure/CONFIG\_SITE file:

\begin{description}
\item \index{COMPAT\_TOOLS\_313}COMPAT\_TOOLS\_313 - Set to YES to build R3.13 extensions with this base.

\item \index{COMPAT\_313}COMPAT\_313 - Set to YES to build R3.13 ioc applications and extensions with this base.

\end{description}

\subsection{Directory definitions}

\index{Install Directory definitions}
The configure files contain definitions for locations in which to install various components. These are all relative to 
\verb|INSTALL_LOCATION|. The default value for \verb|INSTALL_LOCATION| is \verb|$(TOP)|, and \verb|$(T_A)| is the current build's target 
architecture. The default value for \verb|INSTALL_LOCATION| can be overridden in the \verb|configure/CONFIG_SITE| file.

\index{INSTALL\_LOCATION}
\begin{verbatim}
INSTALL_LOCATION_LIB      = $(INSTALL_LOCATION)/lib
INSTALL_LOCATION_BIN      = $(INSTALL_LOCATION)/bin

INSTALL_HOST_BIN          = $(INSTALL_LOCATION_BIN)/$(EPICS_HOST_ARCH)
INSTALL_HOST_LIB          = $(INSTALL_LOCATION_LIB)/$(EPICS_HOST_ARCH)

INSTALL_INCLUDE           = $(INSTALL_LOCATION)/include
INSTALL_DOC               = $(INSTALL_LOCATION)/doc
INSTALL_HTML              = $(INSTALL_LOCATION)/html
INSTALL_TEMPLATES         = $(INSTALL_LOCATION)/templates
INSTALL_DBD               = $(INSTALL_LOCATION)/dbd
INSTALL_DB                = $(INSTALL_LOCATION)/db
INSTALL_CONFIG            = $(INSTALL_LOCATION)/configure
INSTALL_JAVA              = $(INSTALL_LOCATION)/javalib

INSTALL_LIB               = $(INSTALL_LOCATION_LIB)/$(T_A)
INSTALL_SHRLIB            = $(INSTALL_LOCATION_LIB)/$(T_A)
INSTALL_TCLLIB            = $(INSTALL_LOCATION_LIB)/$(T_A)
INSTALL_BIN               = $(INSTALL_LOCATION_BIN)/$(T_A)
\end{verbatim}

\subsection{Extension and Application Specific Configuration}

\index{Extension cnfiguration}
\index{Application Specific Configuration}
The \verb|base/configure| directory contains files with the default build definitions and site specific build definitions. The 
\verb|extensions/configure| directory contains extension specific build definitions (e.g. location of X11 and Motif libraries) and 
``\verb|include <filename>|" lines for the \verb|base/configure| files. Likewise, the \verb|<application>/configure| directory contains 
application specific build definitions and includes for the application source files. Build definitions such as \\ 
\index{CROSS\_COMPILER\_TARGET\_ARCHS}
\verb|CROSS_COMPILER_TARGET_ARCHS| can be overridden in an extension or application by placing an \index{override}override 
definition in the \verb|<top>/configure/CONFIG_SITE| file.

\subsection{RELEASE file}

\index{RELEASE}
Every \verb|<top>/configure| directory contains a \verb|RELEASE| file. \verb|RELEASE| contains a user specified list of other \verb|<top>| 
directory structures containing files needed by the current \verb|<top>|, and may also include other files to take those definitions 
from elsewhere. The macros defined in the \verb|RELEASE| file (or its includes) may reference other defined macros, but 
cannot rely on environment variables to provide definitions.

When make is executed, macro definitions for include, bin, and library directories are automatically generated for each 
external \verb|<top>| definition given in the \verb|RELEASE| file. Also generated are include statements for any existing 
RULES\_BUILD files, cfg/RULES* files, and cfg/CONFIG* files from each external \verb|<top>| listed in the \verb|RELEASE| file.

For example, if \verb|configure/RELEASE| contains the definition
\begin{verbatim}
CAMAC = /home/epics/modules/bus/camac
\end{verbatim}
then the generated macros will be:
\begin{verbatim}
CAMAC_HOST_BIN = /home/epics/modules/bus/camac/bin/$(EPICS_HOST_ARCH)
CAMAC_HOST_LIB = /home/epics/modules/bus/camac/lib/$(EPICS_HOST_ARCH
CAMAC_BIN = /home/epics/modules/bus/camac/bin/$(T_A)
CAMAC_LIB = /home/epics/modules/bus/camac/lib/$(T_A)
RELEASE_INCLUDES += -I/home/epics/modules/bus/camac/include/os
RELEASE_INCLUDES += -I/home/epics/modules/bus/camac/include
RELEASE_DBDFLAGS += -I /home/epics/modules/bus/camac/dbd
RELEASE_DBFLAGS += -I/home/epics/modules/bus/camac/db
RELEASE_PERL_MODULE_DIRS += /home/epics/modules/bus/camac/lib/perl
\end{verbatim}

\index{RELEASE\_DBDFLAGS}
RELEASE\_DBDFLAGS will appear on the command lines for the dbToRecordTypeH, mkmf.pl, and dbExpand tools, 
and \index{RELEASE\_INCLUDES}
RELEASE\_INCLUDES will appear on compiler command lines. CAMAC\_LIB and CAMAC\_BIN can be used in a 
Makefile to define the location of needed scripts, executables, object files, libraries or other files.

Definitions in configure/RELEASE can be overridden for a specific host and target architectures by providing the 
appropriate file or files containing overriding definitions.
\begin{verbatim}
configure/RELEASE.<epics_host_arch>.Common
configure/RELEASE.Common.<targetarch>
configure/RELEASE.<epics_host_arch>.<targetarch>
\end{verbatim}
For \verb|<top>| directory structures created by makeBaseApp.pl, an EPICS base perl script, \index{convertRelease}convertRelease.pl can perform 
consistency checks for the external \verb|<top>| definitions in the RELEASE file and its includes as part of the \verb|<top>| level 
build. Consistancy checks are controlled by value of \index{CHECK\_RELEASE}CHECK\_RELEASE which is defined in \verb|<top>|/configure/
CONFIG\_SITE. CHECK\_RELEASE can be set to YES, NO or WARN, and if YES (the default value), consistency 
checks will be performed. If CHECK\_RELEASE is set to WARN the build will continue even if conflicts are found.

\subsection{Modifying configure/RELEASE* files}

\index{RELEASE}
You should always do a \verb|gnumake clean uninstall| in the \verb|<top>| directory BEFORE adding, changing, or 
removing any definitions in the configure/RELEASE* files and then a \verb|gnumake| at the top level AFTER making the 
changes.

The file \verb|<top>/configure/RELEASE| contains definitions for components obtained from outside \verb|<top>|. If you want to link 
to a new release of anything defined in the file do the following:
\begin{verbatim}
cd <top>
gnumake clean uninstall
edit configure/RELEASE
\end{verbatim}
change the relevant line(s) to point to the new release
\begin{verbatim}
gnumake
\end{verbatim}
All definitions in \verb|<top>/configure/RELEASE| must result in complete path definitions, i.e. relative path names are not 
permitted. If your site could have multiple releases of base and other support \verb|<top>| components installed at once, these 
path definitions should contain a release number as one of the components. However as the RELEASE file is read by 
gnumake, it is permissible to use macro substitutions to define these pathnames, for example:
\begin{verbatim}
SUPPORT = /usr/local/iocapps/R3.14.9 
EPICS_BASE = $(SUPPORT)/base/3-14-9-asd1
\end{verbatim}

\subsection{OS Class specific definitions}

\index{osclass}
Definitions in a Makefile will apply to the host system (the platform on which make is executed) and each system defined 
by \index{CROSS\_COMPILER\_TARGET\_ARCHS}\verb|CROSS_COMPILER_TARGET_ARCHS|.

It is possible to limit the architectures for which a particular definition is used. Most Makefile definition names can be specified with 
an appended underscore ``\verb|_|" followed by an osclass name. If an \verb|_<osclass>| is not specified, then the definition 
applies to the host and all \verb|CROSS_COMPILER_TARGET_ARCHS| systems. If an \verb|_<osclass>| is specified, then the 
definition applies only to systems with the specified os class. A Makefile definition can also have an appended 
\verb|_DEFAULT| specification. If \verb|_DEFAULT| is appended, then the Makefile definition will apply to all systems that do not 
have an \verb|_<osclass>| specification for that definition. If a \verb|_DEFAULT| definition exists but should 
not apply to a particular system OS Class, the value ``\verb|-nil-|" should be specified in the relevant Makefile definition.

Each system has an \index{OS\_CLASS}\verb|OS_CLASS| definition in its \verb|configure/os/CONFIG.Common.<arch>| file. A few examples are:

\begin{description}
\item For vxWorks-* targets \verb|<osclass>| is \verb|vxWorks|.

\item For RTEMS-* targets \verb|<osclass>| is \verb|RTEMS|.

\item For solaris-* targets \verb|<osclass>| is \verb|solaris|.

\item For win32-* targets \verb|<osclass>| is \verb|WIN32|.

\item For linux-* targets \verb|<osclass>| is \verb|Linux|.

\item For darwin-* targets \verb|<osclass>| is \verb|Darwin|.

\item For aix-* targets \verb|<osclass>| is \verb|AIX|.

\end{description}

For example the following Makefile lines specify that product aaa should be created for all systems. Product bbb should 
be created for systems that do not have \verb|OS_CLASS| defined as solaris.

\begin{description}
\item \verb|PROD = aaa|
\item \verb|PROD_solaris = -nil-|
\item \verb|PROD_DEFAULT = bbb|
\end{description}
\subsection{Specifying T\_A specific definitions}

\index{T\_A specific definitions}
It is possible for the user to limit the systems for which a particular definition applies to specific target systems. 

For example the following Makefile lines specify that product aaa should be created for all target architecture which allow 
IOC type products and product bbb should be created only for the vxWorks-68040 and vxWorks-ppc603 targets. 
Remember T\_A is the build's current target architecture. so PROD\_IOC has the bbb value only when the current built 
target architecture is vwWorks-68040 or vxWorks-ppc603

\begin{description}
\item \verb|PROD_IOC = aaa|
\item \verb|VX_PROD_vxWorks-68040 = bbb|
\item \verb|VX_PROD_vxWorks-ppc603 = bbb|
\item \verb|PROD_IOC += VX_PROD_$(T_A)|
\end{description}
\subsection{Host and Ioc targets}

\index{Host makefile targets}
\index{Ioc makefile targets}
Build creates two type of makefile targets: Host and Ioc. Host targets are executables, object files, libraries, and scripts 
which are not part of iocCore. Ioc targets are components of ioc libraries, executables, object files, or iocsh scripts which 
will be run on an ioc.

Each supported target system has a \index{VALID\_BUILDS}\verb|VALID_BUILDS| definition which specifies the type of makefile targets it can 
support. This definition appears in \verb|configure/os/CONFIG.Common.<arch>| or \verb|configure/os/CONFIG.<arch>.<arch>| files.
\begin{description}
\item For vxWorks systems \verb|VALID_BUILDS| is set to ``Ioc".
\item For Unix type systems, \verb|VALID_BUILDS| is set to ``Host Ioc".
\item For RTEMS systems, \verb|VALID_BUILDS| is set to ``Ioc".
\item For WIN32 systems, \verb|VALID_BUILDS| is set to ``Host Ioc".
\end{description}

In a Makefile it is possible to limit the systems for which a particular \index{PROD}PROD, \index{TESTPROD}TESTPROD, \index{LIBRARY, SCRIPTS}LIBRARY, SCRIPTS, and 
\index{OBJS}
OBJS is built. For example the following Makefile lines specify that product aaa should be created for systems that 
support Host type builds. Product bbb should be created for systems that support Ioc type builds. Product ccc should be 
created for all target systems.

\begin{description}
\item PROD\_HOST = aaa

\item PROD\_IOC = bbb

\item PROD = ccc

\end{description}

These definitions can be further limited by specifying an appended underscore ``\_" followed by an osclass or DEFAULT 
specification.

\subsection{User specific override definitions}

\index{User specific override}
User specific override definitions are allowed in user created files in the user's \verb|<home>/configure| subdirectory. These 
override definitions will be used for builds in all \verb|<top>| directory structures. The files must have the following names. 

\begin{verbatim}
<home>/configure/CONFIG_USER
<home>/configure/CONFIG_USER.<epics_host_arch>
<home>/configure/CONFIG_USER.Common.<targetarch>
<home>/configure/CONFIG_USER.<epics_host_arch>.<targetarch>
\end{verbatim}
\index{CONFIG\_USER}

\section{Makefiles}

\index{Makefiles}
\subsection{Name}

\index{Makefile name}
The name of the makefile in each directory must be Makefile.

\subsection{Included Files}

Makefiles normally include files from \verb|<top>/configure|. Thus the makefile ``inherits" rules and definitions from configure. 
The files in \verb|<top>/configure| may in turn include files from another \verb|<top>/configure|. This technique makes it possible to 
share make variables and even rules across \verb|<top>| directories.

\subsection{Contents of Makefiles}

\index{Makefile contents}
\subsubsection{Makefiles in directories containing subdirectories}

A Makefile in this type of directory must define where \verb|<top>| is relative to this directory, include \verb|<top>/configure| files, 
and specify the subdirectories in the desired order of make execution. Running gnumake in a directory with the following 
Makefile lines will cause gnumake to be executed in \verb|<dir1>| first and then \verb|<dir2>|. The build rules do not allow a Makefile 
to specify both subdirectories and components to be built.

\begin{verbatim}
TOP=../..
include $(TOP)/configure/CONFIG
DIRS += <dir1> <dir2>
include $(TOP)/configure/RULES_DIRS

\end{verbatim}

\subsubsection{Makefiles in directories where components are to be built}

A Makefile in this type of directory must define where \verb|<top>| is relative to this directory, include \verb|<top>| configure files, 
and specify the target component definitions. Optionally it may contain user defined rules. Running gnumake in a 
directory with this type of Makefile will cause gnumake to create an \verb|O.<arch>| subdirectory and then execute gnumake to 
build the defined components in this subdirectory. It contains the following lines:

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
<component definition lines>
include $(TOP)/configure/RULES
<optional rules definitions>
\end{verbatim}

\subsection{Simple Makefile examples}

\index{Makefile examples}
Create an IOC type library named asIoc from the source file asDbLib.c and install it into the 
\verb|$(INSTALL_LOCATION)/lib/<arch>| directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
LIBRARY_IOC += asIoc
asIoc_SRCS += asDbLib.c
include $(TOP)/configure/RULES
\end{verbatim}

For each Host type target architecture, create an executable named catest from the catest1.c and catest2.c source files 
linking with the existing EPICS base ca and Com libraries, and then install the catest executable into the 
\verb|$(INSTALL_LOCATION)/bin/<arch>| directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
PROD_HOST = catest
catest_SRCS += catest1.c catest2.c
catest_LIBS = ca Com
include $(TOP)/configure/RULES
\end{verbatim}

\section{Make}

\index{Make}
\subsection{Make vs. gnumake}

\index{gnumake}
EPICS provides an extensive set of make rules. These rules only work with the GNU version of make, gnumake, which is 
supplied by the Free Software Foundation. Thus, on most Unix systems, the native make will not work. On some systems, 
e.g. Linux, GNU make may be the default. This manual always uses gnumake in the examples. 

\subsection{Frequently used Make commands }

\index{Make commands}
NOTE: It is possible to invoke the following commands for a single target architecture by appending \verb|<arch>| to the target 
in the command. 

The most frequently used make commands are:

\begin{description}

\item[gnumake] This rebuilds and installs everything that is not up to date.
NOTE: Executing gnumake without arguments is the same as ``gnumake install"

\item [gnumake help] This command can be executed from the \verb|<top>| directory only. This command prints a page describing the most 
frequently used make commands.

\item[gnumake install]

This rebuilds and installs everything that is not up to date.

\item[gnumake all]

This is the same as ``gnumake install".

\item[gnumake buildInstall]

This is the same as ``gnumake install".

\item[gnumake \textless{}arch\textgreater{}]

This rebuilds and installs everything that is not up to date first for the host arch and then (if different) for the 
specified target arch.

NOTE: This is the same as ``\verb|gnumake install.<arch>|"

\item[gnumake clean] \index{clean} 

This can be used to save disk space by deleting the \verb|O.<arch>| directories that gnumake will create, but does not remove any installed files from the bin, db, dbd etc. directories. ``\verb|gnumake clean.<arch>|" can be invoked to clean a single architecture.

\item[gnumake archclean] \index{archclean} 

This command will remove the current build's \verb|O.<arch>| directories but not \verb|O.Common| directory.

\item[gnumake realclean] \index{realclean} 

This command will remove ALL the \verb|O.<arch>| subdirectories (even those created by a gnumake from another 
EPICS\_HOST\_ARCH).

\item[gnumake rebuild] \index{rebuild} 

This is the same as ``gnumake clean install". If you are unsure about the state of the generated files in an application, just execute ``gnumake rebuild".

\item[gnumake uninstall] \index{uninstall} 

This command can be executed from the \verb|<top>| directory only. It will remove everything installed by gnumake in the include, lib, bin, db, dbd, etc. directories.

\item[gnumake realuninstall] \index{realuninstall} 
This command can be executed from the \verb|<top>| directory only. It will remove all the install directories, include, lib, bin, db, dbd, etc.

\item[gnumake distclean] \index{distclean} 

This command can be executed from the \verb|<top>| directory only. It is the same as issuing both the realclean and 
realuninstall commands.

\item[gnumake cvsclean] \index{cvsclean} 

This command can be executed from the \verb|<top>| directory only. It removes cvs .\#* files in the make directory tree.

\end{description}

\subsection{Make targets}

\index{Make targets}
The following is a summary of targets that can be specified for gnumake: 

\begin{itemize}
\item \verb|<action>|

\item \verb|<arch>|

\item \verb|<action>.<arch>|

\item \verb|<dir>|

\item \verb|<dir>.<action>|

\item  \verb|<dir>.<arch>|

\item \verb|<dir>.<action>.<arch>|

\end{itemize}

where: 

\begin{description}
\item \verb|<arch>| is an architecture such as solaris-sparc, vxWorks-68040, win32-x86, etc.

\item \verb|<action>| is help, clean, realclean, distclean, inc, install, build, rebuild, buildInstall, realuninstall, or uninstall

\item NOTE: help, uninstall, distclean, cvsclean, and realuninstall can only be specified at \verb|<top>|.

\item NOTE: realclean cannot be specified inside an \verb|O.<arch>| subdirectory.

\item \verb|<dir>| is subdirectory name

\end{description}

Note: You can build using your os vendors' native compiler and also build using a supported alternate compiler in the same directory structure because the executables and libraries will be created and installed into separate directories (e.g bin/solaris-sparc and bin/solaris-sparc-gnu).
You can do this by changing your \verb|EPICS_HOST_ARCH|, environment variable between builds or by setting \verb|EPICS_HOST_ARCH| on the gnumake command line.

The build system ensures the host architecture is up to date before building a cross-compiled target, thus Makefiles must be explicit in defining which architectures a component should be built for.

\subsection{Header file dependencies}

\index{Header dependencies}
All product, test product, and library source files which appear in one of the source file definitions (e.g. SRCS, PROD\_SRCS, LIB\_SRCS, \verb|<prodname>_SRCS|) will have their header file dependencies automatically generated and included as part of the Makefile.

\section{Makefile definitions}

The following components can be defined in a Makefile:

\subsection{Source file directories}

\index{Source file dirs}
Normally all product, test product, and library source files reside in the same directory as the Makefile. OS specific source files are allowed and should reside in subdirectories \verb|os/<os_class>| or \verb|os/posix| or \verb|os/default|.

The build rules also allow source files to reside in subdirectories of the current Makefile directory (src directory). For each subdirectory \verb|<dir>| containing source files add the SRC\_DIRS definition.

\begin{verbatim}
SRC_DIRS += <dir>
\end{verbatim}

\index{SRC\_DIRS}
where \verb|<dir>| is a relative path definition. An example of SRC\_DIRS is

\begin{verbatim}
SRC_DIRS += ../dir1 ../dir2
\end{verbatim}

The directory search order for the above definition is 

\begin{verbatim}
. 
../os/$(OS_CLASS) ../os/posix ../os/default
../dir1/os/$(OS_CLASS) ../dir1/os/posix ../dir1/os/default 
../dir2/os/$(OS_CLASS) ../dir2/os/posix ../dir2/os/default
..
../dir1 ../dir2
\end{verbatim}

where the build directory \verb|O.<arch>| is \verb|.| and the \verb|src| directory is \verb|..|. 

\subsection{Posix C source code}

\index{Posix C source code}
The epics base config files assume posix source code and define \index{POSIX}POSIX to be YES as the default. Individual Makefiles 
can override this by setting POSIX to NO. Source code files may have the suffix .c, .cc, .cpp, or .C.

\subsection{Breakpoint Tables}

\index{Breakpoint Tables}
For each breakpoint table dbd file, \verb|bpt<table name>.dbd|, to be created from an existing \verb|bpt<table name>.data| file, add the 
definition

\begin{verbatim}
DBD += bpt<table name>.dbd
\end{verbatim}

\index{DBD}to the Makefile. The following Makefile will create a bptTypeJdegC.dbd file from an existing bptTypeJdegC.data file 
using the EPICS base utility program makeBpt and install the new dbd file into the \$(INSTALL\_LOCATION)/dbd 
directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
DBD += bptTypeJdegC.dbd
include $(TOP)/configure/RULES
\end{verbatim}

\subsection{Record Type Definitions}

\index{Record Type Definitions}
For each new record type, the following definition should be added to the makefile:

\begin{verbatim}
DBDINC += <rectype>Record
\end{verbatim}

\index{DBDINC}
A \verb|<rectype>Record.h| header file will be created from an existing \verb|<rectype>Record.dbd| file using the EPICS base utility 
program dbToRecordTypeH. This header will be installed into the \$(INSTALL\_LOCATION)/include directory and the 
dbd file will be installed into the \$(INSTALL\_LOCATION)/dbd directory.

The following Makefile will create xxxRecord.h from an existing xxxRecord.dbd file, install xxxRecord.h into 
\$(INSTALL\_LOCATION)/include, and install xxxRecord.dbd into \$(INSTALL\_LOCATION)/dbd.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
DBDINC += xxxRecord
include $(TOP)/configure/RULES
\end{verbatim}

\subsection{Menus}

\index{Menus}
If a menu \verb|menu<name>.dbd| file is present, then add the following definition:

\begin{verbatim}
DBDINC += menu<name>.h
\end{verbatim}

\index{DBDINC}The header file, \verb|menu<name>.h| will be created from the existing \verb|menu<name>.dbd| file using the EPICS base utility 
program dbToMenuH and installed into the \verb|$(INSTALL_LOCATION)/include| directory and the menu dbd file will be 
installed into \$(INSTALL\_LOCATION)/dbd.

The following Makefile will create a menuConvert.h file from an existing menuConvert.dbd file and install 
menuConvert.h into \$(INSTALL\_LOCATION)/include and menuConvert.dbd into \$(INSTALL\_LOCATION)/dbd.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
DBDINC = menuConvert.h
include $(TOP)/configure/RULES
\end{verbatim}

\subsection{Expanded Database Definition Files}

\index{Expanded DBD files}
\index{Database Definition}
Database definition include files named \verb|<name>Include.dbd| containing includes for other database definition files can be 
expanded by the EPICS base utility program \verb|dbExpand| into a created \verb|<name>.dbd| file and the \verb|<name>.dbd| file installed 
into \$(INSTALL\_LOCATION)/dbd. The following variables control the process:

\index{dbExpand}
\begin{verbatim}
DBD += <name>.dbd
USR_DBDFLAGS += -I <include path>
USR_DBDFLAGS += -S <macro substitutions>
<name>_DBD += <file1>.dbd <file2>.dbd ...
\end{verbatim}

\index{DBD}
\index{USER\_DBDFLAGS}
where 

\begin{verbatim}
DBD += <name>.dbd
\end{verbatim}

is the name of the output dbd file to contain the expanded definitions. It is created by expanding an existing or build          
created \verb|<name>Include.dbd| file and then copied into \$(INSTALL\_LOCATION)/dbd.

An example of a file to be expanded is exampleInclude.dbd containing the following lines

\begin{verbatim}
include "base.dbd"
include "xxxRecord.dbd"
device(xxx,CONSTANT,devXxxSoft,"SoftChannel")
\end{verbatim}

\index{base.dbd}\verb|USR_DBDFLAGS| defines optional flags for dbExpand. Currently only an include path (\verb|-I <path>|) and macro substitution 
(\verb|-S <substitution>|) are supported. The include paths for EPICS base/dbd, and other \verb|<top>/dbd| directories will 
automatically be added during the build if the \verb|<top>| names are specified in the configure/RELEASE file.

A database definition include file named \verb|<name>Include.dbd| containing includes for other database definition files can 
be created from a \verb|<name>_DBD| definition. The lines

\begin{verbatim}
DBD += <name>.dbd
<name>_DBD += <file1>.dbd <file2>.dbd ...
\end{verbatim}

\index{DBD}will create an expanded dbd file \verb|<name>.dbd| by first creating a \verb|<name>Include.dbd|. For each filename in the 
\verb|<name>_DBD| definition, the created \verb|<name>Include.dbd| will contain an include statement for that filename. Then   the 
expanded DBD file is generated from the created \verb|<name>Include.dbd| file and installed into \$(INSTALL\_LOCATION)/
dbd. 

The following Makefile will create an expanded dbd file named example.dbd from an existing exampleInclude.dbd file 
and then install example.dbd into the \$(INSTALL\_LOCATION)/dbd directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
DBD += exampleApp.dbd
include $(TOP)/configure/RULES
\end{verbatim}

The following Makefile will create an exampleInclude.dbd file from the example\_DBD definition then expand it to create 
an expanded dbd file, example.dbd, and install example.dbd into the \$(INSTALL\_LOCATION)/dbd directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
DBD += example.dbd
example_DBD += base.dbd xxxRecord.dbd xxxSupport.dbd
include $(TOP)/configure/RULES
\end{verbatim}

The created exampleInclude.dbd file will contain the following lines

\begin{verbatim}
include "base.dbd"
include "xxxRecord.dbd"
include "xxxSupport.dbd"
\end{verbatim}

\subsection{Registering Support Routines for Expanded Database Definition Files}

\index{Registering routines for DBD files}
\index{Registering support routines}
\index{Expanded Database Definition Files}
A source file which registers simple static variables and record/device/driver support routines with iocsh can be created. 
The list of variables and routines to register is obtained from lines in an existing \verb|dbd| file.

The following line in a Makefile will result in \verb|<name>_registerRecordDeviceDriver.cpp| being created, 
compiled, and linked into \verb|<prodname>|. It requires that the file \verb|<name>.dbd| exist or can be created using other make rules.

\begin{verbatim}
<prodname>_SRCS += <name>_registerRecordDeviceDriver.cpp
\end{verbatim}

An example of registering the variable mySubDebug and the routines mySubInit and mySubProcess is \verb|<name>.dbd| 
containg the following lines

\begin{verbatim}
variable(mySubDebug)
function(mySubInit)
function(mySubProcess)
\end{verbatim}

\subsection{Database Definition Files}

\index{Database Definition}
The following line installs the existing named dbd files into \$(INSTALL\_LOCATION)/dbd without expansion.

\begin{verbatim}
DBD += <name>.dbd
\end{verbatim}

\index{DBD}\subsection{DBD install files}

\index{DBD install files}
Definitions of the form:

\begin{verbatim}
DBD_INSTALLS += <name>
\end{verbatim}

\index{DBD\_INSTALLS}result in files being installed to the \$(INSTALL\_LOCATION/dbd directory. The file \verb|<name>| can appear with or without 
a directory prefix. If the file has a directory prefix e.g. \$(APPNAME)/dbd/, it is copied from the specified location. If a 
directory prefix is not present, make will look in the current source directory for the file.

\subsection{Database Files}

\index{Database Files}
For most databases just the name of the database has to be specified. Make will figure out how to generate the file: 

\begin{verbatim}
DB += xxx.db
\end{verbatim}

\index{DB}generates xxx.db depending on which source files exist and installs it into \$(INSTALL\_LOCATION)/db.

A \verb|<name>.db| database file will be created from an optional \verb|<name>.template| file and/or an optional 
\verb|<name>.substitutions| file, If the \index{substitution file}substitution file exists but the \index{template file}template file is not named \verb|<name>.template|, the template 
file name can be specified as

\begin{verbatim}
<name>_TEMPLATE = <template file name>
\end{verbatim}

A \verb|*<nn>.db| database file will be created from a *.template and a \verb|*<nn>.substitutions| file, (where nn is an optional index 
number).

If a \verb|<name>| substitutions file contains ``file" references to other input files, these referenced files are  made dependencies 
of the created \verb|<name>.db| by the \index{makeDbDepends.pl}makeDbDepends.pl perl tool.

The \index{Macro Substitutions and Include tool}Macro Substitutions and Include tool, msi, will be used to generate the database, and msi must either be in your path 
or you must redefine \index{MSI}MSI as the full path name to the msi binary in a RELEASE file or Makefile. An example MSI 
definition is

\begin{verbatim}
MSI = /usr/local/epics/extensions/bin/${EPICS_HOST_ARCH}/msi
\end{verbatim}

\index{msi}
\index{msi}
Template files \verb|<name>.template|, and db files, \verb|<name>.db|, will be created from an edf file \verb|<name>.edf| and an 
\verb|<name>.edf| file will be created from a \verb|<name>.sch| file.

Template and substitution files can be installed.

\begin{verbatim}
DB += xxx.template xxx.substitutions
\end{verbatim}

\index{template file}
\index{substitutions file}
generates and installs these files. If one or more xxx.substitutions files are to be created by script, the script name must be 
placed in the CREATESUBSTITUTIONS variable (e.g. CREATESUBSTITUTIONS=mySubst.pl). This script will be 
executed by gnumake with the prefix of the substitution file name to be generated as its argument. If (and only if) there 
are script generated substitutions files, the prefix of any inflated database's name may not equal the prefix of the name of 
any template used within the directory.

\subsection{DB install files}

\index{DB install files}
Definitions of the form:

\begin{verbatim}
DB_INSTALLS += <name>
\end{verbatim}

\index{DB\_INSTALLS}result in files being installed to the \$(INSTALL\_LOCATION/db directory. The file \verb|<name>| can appear with or without a 
directory prefix. If the file has a directory prefix e.g. \$(APPNAME)/db/, it is copied from the specified location. If a 
directory prefix is not present, make will look in the current source directory for the file.

\subsection{Compile and link command options}

\index{Compiler options}
\index{link options}
Any of the following can be specified:

\subsubsection{Options for all compile/link commands.}

These definitions will apply to all compiler and linker targets.

\begin{description}

\item \index{USR\_INCLUDES}\verb|USR_INCLUDES += -I<name>|

header file directories each prefixed by a ``-I".

\item \verb|USR_INCLUDES_<osclass> += -I<name>|

os specific header file directories each prefixed by a ``-I".

\item \verb|USR_INCLUDES_DEFAULT += -I<name>|

header file directories each prefixed by ``\verb|-I|" for any arch that does not have a \verb|USR_INCLUDE_<osclass>| definition

\item \index{USR\_CFLAGS}\verb|USR_CFLAGS += <c flags>|

C compiler options.

\item \verb|USR_CFLAGS_<osclass> += <c flags>|

os specific C compiler options.

\item \verb|USR_CFLAGS_<arch> += <c flags>|

target architecture specific C compiler options.

\item \verb|USR_CFLAGS_DEFAULT += <c flags>|

C compiler options for any arch that does not have a \verb|USR_CFLAGS_<osclass>| definition

\item \index{USR\_CXXFLAG}\verb|USR_CXXFLAGS += <c++ flags>|

C++ compiler options.

\item \verb|USR_CXXFLAGS_<osclass> += <c++ flags>|

C++ compiler options for the specified osclass.

\item \verb|USR_CXXFLAGS_<arch> += <c++ flags>|

C++ compiler options for the specified target architecture.

\item \verb|USR_CXXFLAGS_DEFAULT += <c++ flags>|

C++ compiler options for any arch that does not have a \verb|USR_CXXFLAGS_<osclass>| definition

\item \index{USR\_CPPFLAGS}\verb|USR_CPPFLAGS += <preprocessor flags>|

C preprocessor options.

\item \verb|USR_CPPFLAGS_<osclass> += <preprocessor flags>|

os specific C preprocessor options.

\item \verb|USR_CPPFLAGS_<arch> += <preprocessor flags>|

target architecture specific C preprocessor options.

\item \verb|USR_CPPFLAGS_DEFAULT += <preprocessor flags>|

C preprocessor options for any arch that does not have a \verb|USR_CPPFLAGS_<osclass>| definition

\item \index{USR\_LDFLAGS}\verb|USR_LDFLAGS += <linker flags>|

linker options.

\item \verb|USR_LDFLAGS_<osclass> += <linker flags>|

os specific linker options.

\item \verb|USR_LDFLAGS_DEFAULT += <linker flags>|

linker options for any arch that does not have a \verb|USR_LDFLAGS_<osclass>| definition

\end{description}

 

\subsubsection{Options for a target specific compile/link command.}

\begin{description}

\item \index{name\_INCLUDES}\verb|<name>_INCLUDES += -I<name>|

header file directories each prefixed by a ``-I".

\item \verb|<name>_INCLUDES_<osclass> += -I<name>|

os specific header file directories each prefixed by a ``-I".

\item \verb|<name>_INCLUDES_<T_A> += -I<name>|

target architecture specific header file directories each prefixed by a ``-I".

\item \index{name\_CFLAGS}\verb|<name>_CFLAGS += <c flags>|

c compiler options.

\item \verb|<name>_CFLAGS_<osclass> += <c flags>|

os specific c compiler options.

\item \verb|<name>_CFLAGS_<T_A> += <c flags>|

target architecture specific c compiler options.

\item \index{name\_CXXFLAGS}\verb|<name>_CXXFLAGS += <c++ flags>|

c++ compiler options.

\item \verb|<name>_CXXFLAGS_<osclass> += <c++ flags>|

c++ compiler options for the specified osclass.

\item \verb|<name>_CXXFLAGS_<T_A> += <c++ flags>|

c++ compiler options for the specified target architecture.

\item \index{name\_CPPFLAGS}\verb|<name>_CPPFLAGS += <preprocessor flags>|

c preprocessor options.

\item \verb|<name>_CPPFLAGS_<osclass> += <preprocessor flags>|

os specific c preprocessor options.

\item \verb|<name>_CPPFLAGS_<T_A> += <preprocessor flags>|

target architecture specific c preprocessor options.

\item \index{name\_LDFLAGS}\verb|<name>_LDFLAGS += <linker flags>|

linker options.

\item \verb|<name>_LDFLAGS_<osclass> += <linker flags>|

os specific linker options.

\end{description}

\subsection{Libraries}

\index{Libraries}
A library is created and installed into \verb|$(INSTALL_LOCATION)/lib/<arch>| by specifying its name and the name of the 
object and/or source files containing code for the library. An object or source file name can appear with or without a 
directory prefix. If the file name has a directory prefix e.g. \$(EPICS\_BASE\_BIN), it is taken from the specified location. 
If a directory prefix is not present, make will first look in the source directories for a file with the specified name and next 
try to create the file using existing configure rules. A library filename prefix may be prepended to the library name when 
the file is created. For Unix type systems and vxWorks the library prefix is lib and there is no prefix for WIN32. Also a 
library suffix appropriate for the library type and target arch (e.g. .a, .so, .lib, .dll) will be appended to the filename when 
the file is created.

vxWorks and RTEMS Note: Only archive libraries are created.

Shared libraries Note: Shared libraries can be built for any or all HOST type architectures. The definition of 
\index{SHARED\_LIBRARIES}
SHARED\_LIBRARIES (YES/NO) in base/configure/CONFIG\_SITE determines whether shared or archive libraries will 
be built. When SHARED\_LIBRARIES is YES, both archive and shared libraries are built. This definition can be 
overridden for a specific arch in an \verb|configure/os/CONFIG_SITE.<arch>.Common| file.,The default definition for 
SHARED\_LIBRARIES in the EPICS base distribution file is YES for all host systems.

win32 Note: An object library file is created when \index{SHARED\_LIBRARIES}SHARED\_LIBRARIES=NO, \verb|<name>.lib| which is installed into 
\verb|$(INSTALL_LOCATION)/lib/<arch>|. Two library files are created when SHARED\_LIBRARIES=YES, \verb|<name>.lib|, an 
import library for DLLs, which is installed into \verb|$(INSTALL_LOCATION)/lib/<arch>|, and \verb|<name>.dll| which is installed 
into \verb|$(INSTALL_LOCATION)/bin/<arch>|. (Warning: The file \verb|<name>.lib| will only be created by the build if there are 
exported symbols from the library.) If SHARED\_LIBRARIES=YES, the directory \\
\verb|$(INSTALL_LOCATION)/bin/<arch>| 
must be in the user's path during builds to allow invoking executables which were linked with shared libraries. NOTE: the 
\verb|<name>.lib| files are different for shared and nonshared builds.

\subsubsection{Specifying the library name.}

\index{library name}
Any of the following can be specified:

\begin{description}

\item \index{LIBRARY}\verb|LIBRARY += <name>|

A library will be created for every target arch.

\item \verb|LIBRARY_<osclass> += <name>|

Library \verb|<name>| will be created for all archs of the specified osclass.

\item \verb|LIBRARY_DEFAULT += <name>|

Library \verb|<name>| will be created for any arch that does not have a \verb|LIBRARY_<osclass>| definition

\item \index{LIBRARY\_IOC}\verb|LIBRARY_IOC += <name>|

Library \verb|<name>| will be created for IOC type archs.

\item \verb|LIBRARY_IOC_<osclass> += <name>|

Library \verb|<name>| will be created for all IOC type archs of the specified osclass.

\item \verb|LIBRARY_IOC_DEFAULT += <name>|

Library \verb|<name>| will be created for any IOC type arch that does not have a \verb|LIBRARY_IOC_<osclass>| 
definition

\item \index{LIBRARY\_HOST}\verb|LIBRARY_HOST += <name>|

Library \verb|<name>| will be created for HOST type archs.

\item \verb|LIBRARY_HOST_<osclass> += <name>|

Library \verb|<name>| will be created for all HOST type archs of the specified osclass.

\item \verb|LIBRARY_HOST_DEFAULT += <name>|

Library \verb|<name>| will be created for any HOST type arch that does not have a \verb|LIBRARY_HOST_<osclass>| 
definition

\end{description}

\subsubsection{Specifying library source file names}

\index{Library Source file}
Source file names, which must have a suffix, are defined as follows:

\begin{description}
\item \index{SRCS}\verb|SRCS += <name>|

Source files will be used for all defined libraries and products.

\item \verb|SRCS_<osclass> += <name>|

Source files will be used for all defined libraries and products for all archs of the specified osclass.

\item \verb|SRCS_DEFAULT += <name>|

Source files will be used for all defined libraries and products for any arch that does not have a 
\verb|SRCS_<osclass>| definition

\end{description}

LIBSRCS and LIB\_SRCS have the same meaning. LIBSRCS is deprecated, but retained for R3.13 compatibility.

\begin{description}

\item \index{LIBSRCS}\verb|LIBSRCS += <name>|

Source files will be used for all defined libraries.

\item \verb|LIBSRCS_<osclass> += <name>|

Source files will be used for all defined libraries for all archs of the specified osclass.

\item \verb|LIBSRCS_DEFAULT += <name>|

Source files will be used for all defined libraries for any arch that does not have a \verb|LIBSRCS_<osclass>| 
definition

\item \index{USR\_SRCS}\verb|USR_SRCS += <name>|

Source files will be used for all defined products and libraries.

\item

\item \verb|USR_SRCS_<osclass> += <name>|

Source files will be used for all defined products and libraries for all archs of the specified osclass.

\item \verb|USR_SRCS_DEFAULT += <name>|

Source files will be used for all defined products and libraries for any arch that does not have a 
\verb|USR_SRCS_<osclass>| definition

\item \index{LIB\_SRCS}\verb|LIB_SRCS += <name>|

Source files will be used for all libraries.

\item \verb|LIB_SRCS_<osclass> += <name>|

Source files will be used for all defined libraries for all archs of the specified osclass.

\item \verb|LIB_SRCS_DEFAULT += <name>|

Source files will be used for all defined libraries for any arch that does not have a \verb|LIB_SRCS_<osclass>| 
definition

\item

\item \index{name\_SRCS}\verb|<libname>_SRCS += <name>|

Source files will be used for the named library.

\item \verb|<libname>_SRCS_<osclass> += <name>|

Source files will be used for named library for all archs of the specified osclass.

\item \verb|<libname>_SRCS_DEFAULT += <name>|

Source files will be used for named library for any arch that does not have a \verb|<libname>_SRCS_<osclass>| 
definition

\end{description}

\subsubsection{Specifying library object file names}

\index{Library object file}
Library object file names should only be specified for object files which will not be built in the current directory. For 
object files built in the current directory, library source file names should be specified. See Specifying Library Source File 
Names above.

Object files which have filename with a ``.o" or ``.obj" suffix are defined as follows and can be specified without the suffix 
but should have the directory prefix 

\begin{description}

\item \index{USR\_OBJS}\verb|USR_OBJS += <name>|

Object files will be used in builds of all products and libraries

\item \verb|USR_OBJS_<osclass> += <name>|

Object files will be used in builds of all products and libraries for archs with the specified osclass.

\item \verb|USR_OBJS_DEFAULT += <name>|

Object files will be used in builds of all products and libraries for archs without a \verb|USR_OBJS_<osclass>|
definition specified.

\item \index{LIB\_OBJS}\verb|LIB_OBJS += <name>|

Object files will be used in builds of all libraries.

\item \verb|LIB_OBJS_<osclass> += <name>|

Object files will be used in builds of all libraries for archs of the specified osclass.

\item \verb|LIB_OBJS_DEFAULT += <name>|

Object files will be used in builds of all libraries for archs without a \verb|LIB_OBJS_<osclass>| definition 
specified.

\item \index{name\_OBJS}\verb|<libname>_OBJS += <name>|

Object files will be used for all builds of the named library)

\item \verb|<libname>_OBJS_<osclass> += <name>| 

Object files will be used in builds of the library for archs with the specified osclass.

\item \verb|<libname>_OBJS_DEFAULT += <name>|

Object files will be used in builds of the library for archs without a \verb|<libname>_OBJS_<osclass>| definition 
specified.

\end{description}

Combined object files, from R3.13 built modules and applications which have file names that do not include a ``.o" or ".obj" suffix (e.g. xyzLib) are defined as follows:

\begin{description}

\item \index{USR\_OBJLIBS}\verb|USR_OBJLIBS += <name>|

Combined object files will be used in builds of all libraries and products.

\item \verb|USR_OBJLIBS_<osclass> += <name>|

Combined object files will be used in builds of all libraries and products for archs of the specified osclass.

\item \verb|USR_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of all libraries and products for archs without a \verb|USR_OBJLIBS_<osclass>| definition specified.

\item

\item \index{LIB\_OBJLIBS}\verb|LIB_OBJLIBS += <name>|

Combined object files will be used in builds of all libraries.

\item \verb|LIB_OBJLIBS_<osclass> += <name>|

Combined object files will be used in builds of all libraries for archs of the specified osclass.

\item \verb|LIB_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of all libraries for archs without a \verb|LIB_OBJLIBS_<osclass>|
definition specified.

\item

\item \index{name\_OBJLIBS}\verb|<libname>_OBJLIBS += <name>|

Combined object files will be used for all builds of the named library.

\item \verb|<libname>_OBJLIBS_<osclass> += <name>| 

Combined object files will be used in builds of the library for archs with the specified osclass.

\item \verb|<libname>_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of the library for archs without a 
\verb|<libname>_OBJLIBS_<osclass>|
definition specified.

\item

\item \index{name\_LDOBJS}\verb|<libname>_LDOBJS += <name>|

Combined object files will be used for all builds of the named library. (deprecated)

\item \verb|<libname>_LDOBJS_<osclass> += <name>|

Combined object files will be used in builds of the library for archs with the specified osclass. (deprecated)

\item \verb|<libname>_LDOBJS_DEFAULT += <name>|

Combined object files will be used in builds of the library for archs without a \verb|<libname>_LDOBJS_<osclass>|
definition specified. (deprecated)

\end{description}

\subsubsection{LIBOBJS definitions}

\index{LIBOBJS}
Previous versions of epics (3.13 and before) accepted definitions like:

\begin{description}

\item \verb|LIBOBJS += $<support>_BIN)/xxx.o|

These are gathered together in files such as baseLIBOBJS. To use such definitions include the lines:

\item \verb|-include ../baseLIBOBJS|

\item \verb|<libname>_OBJS += $(LIBOBJS)|

Note: vxWorks applications created by makeBaseApp.pl from 3.14 Base releases no longer have a file 
named baseLIBOBJS. Base record and device support now exists in archive libraries.

\end{description}

\subsubsection{Specifying dependant libraries to be linked when creating a library}

\index{Specifying libraries dependancies}
\index{product libraries}
\index{libraries}
For each library name specified which is not a system library nor a library from an EPICS top defined in the configure/
RELEASE file, a \verb|<name>_DIR| definition must be present in the Makefile to specify the location of the library. 

Library names, which must not have a directory and ``lib" prefix nor a suffix, are defined as follows:

\begin{description}

\item \index{LIB\_LIBS}\verb|LIB_LIBS += <name>|

Libraries to be used when linking all defined libraries.

\item \verb|LIB_LIBS_<osclass> += <name>|

Libraries to be used or all archs of the specified osclass when linking all defined libraries.

\item \verb|LIB_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|LIB_LIBS_<osclass>| definition when linking all 
defined libraries.

\item

\item \index{USR\_LIBS}\verb|USR_LIBS += <name>|

Libraries to be used when linking all defined products and libraries.

\item \verb|USR_LIBS_<osclass> += <name>|

Libraries to be used or all archs of the specified osclasswhen linking all defined products and libraries.

\item \verb|USR_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|USR_LIBS_<osclass>| definition when linking all 
defined products and libraries.

\item

\item \index{name\_LIBS}\verb|<libname>_LIBS += <name>|

Libraries to be used for linking the named library.

\item \verb|<libname>_LIBS_<osclass> += <name>|

Libraries will be used for all archs of the specified osclass for linking named library.

\item \verb|<libname>_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|<libname>_LIBS_<osclass>| definition when linking 
named library.

\item

\item \index{name\_SYS\_LIBS}\verb|<libname>_SYS_LIBS += <name>|

System libraries to be used for linking the named library.

\item \verb|<libname>_SYS_LIBS_<osclass> += <name>|

System libraries will be used for all archs of the specified osclass for linking named library.

\item \verb|<libname>_SYS_LIBS_DEFAULT += <name>|

System libraries to be used for any arch that does not have a \verb|<libname>_LIBS_<osclass>| definition when linking named library.

\end{description}

\subsubsection{The order of dependant libraries}

\index{Library link order}
Dependant library names appear in the following order on a library link line:

\begin{enumerate}
\item \index{name\_LIBS}\verb|<libname>_LIBS|

\item \verb|<libname>_LIBS_<osclass>| or \verb|<libname>_LIBS_DEFAULT|

\item \index{LIB\_LIBS}\verb|LIB_LIBS|

\item \verb|LIB_LIBS_<osclass>| or \verb|LIB_LIBS_DEFAULT|

\item \index{USR\_LIBS}\verb|USR_LIBS|

\item \verb|USR_LIBS_<osclass>| or \verb|USR_LIBS_DEFAULT|

\item \index{name\_SYS\_LIBS}\verb|<libname>_SYS_LIBS|

\item \verb|<libname>_SYS_LIBS_<osclass>| or \verb|<libname>_SYS_LIBS_DEFAULT|

\item \index{LIB\_SYS\_LIBS}\verb|LIB_SYS_LIBS|

\item \verb|LIB_SYS_LIBS_<osclass>| or \verb|LIB_SYS_LIBS_DEFAULT|

\item \index{USR\_SYS\_LIBS}\verb|USR_SYS_LIBS|

\item \verb|USR_SYS_LIBS_<osclass>| or \verb|USR_SYS_LIBS_DEFAULT|
\end{enumerate}

\subsubsection{Specifying library DLL file names (deprecated)}

WIN32 libraries require all external references to be resolved, so if a library contains references to items in other DLL 
libraries, these DLL library names must be specified (without directory prefix and without ``.dll" suffix) as follows:

\begin{description}

\item \index{DLL\_LIBS}\verb|DLL_LIBS += <name>|

These DLLs will be used for all libraries.

\item \index{name\_DLL\_LIBS}\verb|<libname>_DLL_LIBS += <name>|

These DLLs will be used for the named library.

Each \verb|<name>| must have a corresponding \verb|<name>_DIR| definition specifying its directory location.

\end{description}

\subsubsection{Specifying shared library version number}

\index{Library version number}
A library version number can be specified when creating a shared library as follows:

\begin{description}

\item \index{SHRLIB\_VERSION}\verb|SHRLIB_VERSION = <version>|

\end{description}

On WIN32 this results in \verb|/version:$(SHRLIB_VERSION)| link option. On Unix type hosts \verb|.$(SHRLIB_VERSION)| is 
appended to the shared library name and a symbolic link is created for the unversioned library name. \\
\verb|$(EPICS_VERSION).$(EPICS_REVISION)| is the default value for \verb|SHRLIB_VERSION|.

\subsubsection{Library example:}

\index{Library example}

\begin{verbatim}
    LIBRARY_vxWorks += vxWorksOnly
    LIBRARY_IOC += iocOnly
    LIBRARY_HOST += hostOnly
    LIBRARY += all
    vxWorksOnly_OBJS += $(LINAC_BIN)/vxOnly1
    vxWorksOnly_SRCS += vxOnly2.c
    iocOnly_OBJS += $(LINAC_BIN)/iocOnly1
    iocOnly_SRCS += iocOnly2.cpp
    hostOnly_OBJS +=  $(LINAC_BIN)/host1
    all_OBJS += $(LINAC_BIN)/all1
    all_SRCS += all2.cpp
\end{verbatim}
If the architectures defined in \verb|<top>/configure| are solaris-sparc and vxWorks-68040 and LINAC is defined in the \verb|<top>/configure/RELEASE| file, then the following libraries will be created:

\begin{itemize}
\item \$(INSTALL\_LOCATION)/bin/vxWork-68040/libvxWorksOnly.a : \$(LINAC\_BIN)/vxOnly1.o vxOnly2.o

\item \$(INSTALL\_LOCATION)/bin/vxWork-68040/libiocOnly.a : \$(LINAC\_BIN/iocOnly1.o iocOnly2.o

\item \$(INSTALL\_LOCATION)/lib/solaris-sparc/libiocOnly.a : \$(LINAC\_BIN)/iocOnly1.o iocOnly2.o

\item \$(INSTALL\_LOCATION)/lib/solaris-sparc/libhostOnly.a : \$(LINAC\_BIN)/host1.o

\item \$(INSTALL\_LOCATION)/bin/vxWork-68040/liball.a : \$(LINAC\_BIN)/all1.o all2.o

\item \$(INSTALL\_LOCATION)/lib/solaris-sparc/liball.a : \$(LINAC\_BIN)/all1.o all2.o

\end{itemize}

\subsection{Loadable libraries}

\index{Loadable libraries}

Loadable libraries are regular libraries which are not required to have all symbols resolved during the build. The intent is 
to create dynamic plugins so no archive library is created. Source file, object files, and dependant libraries are specified in 
exactly the same way as for regular libraries.

Any of the following can be specified:

\begin{description}
\item \index{LOADABLE\_LIBRARY}\verb|LOADABLE_LIBRARY += <name>|

The \verb|<name>| loadable library will be created for every target arch.

\item \verb|LOADABLE_LIBRARY_<osclass> += <name>|

Loadable library \verb|<name>| will be created for all archs of the specified osclass.

item \verb|LOADABLE_LIBRARY_DEFAULT += <name>|

Loadable library \verb|<name>| will be created for any arch that does not have a 
\verb|LOADABLE_LIBRARY_<osclass>| definition

\item 

\item \index{LOADABLE\_LIBRARY\_HOST}\verb|LOADABLE_LIBRARY_HOST += <name>|

Loadable library \verb|<name>| will be created for HOST type archs.

\item \verb|LOADABLE_LIBRARY_HOST_<osclass> += <name>|

Loadable library \verb|<name>| will be created for all HOST type archs of the specified osclass.

\item \verb|LOADABLE_LIBRARY_HOST_DEFAULT += <name>|

Loadable library \verb|<name>| will be created for any HOST type arch that does not have a \\
\verb|LOADABLE_LIBRARY_HOST_<osclass>| definition

\end{description}

\subsection{ Combined object libraries (VxWorks only)}

\index{Loadable libraries}
Combined object libraries are regular combined object files which have been created by linking together multiple object 
files. OBJLIB specifications in the Makefile create a combined object file and a corresponding munch file for vxWorks 
target architectures only. Combined object libraries have a Library.o suffix. It is possible to generate and install combined 
object libraries by using definitions:

\begin{verbatim}
OBJLIB += <name>
OBJLIB_vxWorks += <name>
OBJLIB_SRCS += <srcname1> <srcname2> ...
OBJLIB_OBJS += <objname1> <objname2> ...
\end{verbatim}

\index{OBJLIB}
\index{OBJLIB\_SRCS}
\index{OBJLIB\_OBJS}
These definitions result in the combined object file \verb|<name>Library.o| and its corresponding \verb|<name>Library.munch| munch 
file being built for each vxWorks architecture from source/object files in the OBJLIB\_SRCS/OBJLIB\_OBJS definitions. 
The combined object file and the munch file are installed into the \verb|$(INSTALL_LOCATION)/bin/<arch>| directory. 

\subsection{Object Files}

\index{Object Files}
It is possible to generate and install object files by using definitions:

\begin{description}
\item \index{OBJS}\verb|OBJS += <name>|

\item \verb|OBJS_<osclass> += <name>|

\item \verb|OBJS_DEFAULT += <name>|

\item \index{OBJS\_IOC}\verb|OBJS_IOC += <name>|

\item \verb|OBJS_IOC_<osclass> += <name>|

\item \verb|OBJS_IOC_DEFAULT += <name>|

\item \index{OBJS\_HOST}\verb|OBJS_HOST += <name>|

\item \verb|OBJS_HOST_<osclass> += <name>|

\item \verb|OBJS_HOST_DEFAULT += <name>|

\end{description}

These will cause the specified file to be generated from an existing source file for the appropriate target arch and installed 
into \verb|$(INSTALL_LOCATION)/bin/<arch>|.

The following Makefile will create the abc object file for all target architectures, the def object file for all target archs 
except vxWorks, and the xyz object file only for the vxWorks target architecture and install them into the appropriate 
\verb|$(INSTALL_LOCATION)/bin/<arch>| directory.

\begin{verbatim}
TOP=../../..
include $(TOP)/configure/CONFIG
OBJS += abc
OBJS_vxWorks += xyz
OBJS_DEFAULT += def
include $(TOP)/configure/RULES
\end{verbatim}

\subsection{State Notation Programs}

\index{State Notation Programs}
A state notation program file can be specified as a source file in any SRC definition. For example:

\begin{verbatim}
<prodname>_SRCS += <name>.stt
\end{verbatim}

\index{name\_SRCS}The state notation compiler \verb|snc| will generate the file \verb|<name>.c| from the state notation program file \verb|<name>.stt|. 
This C file is compiled and the resulting object file is linked into the \verb|<prodname>| product.

A state notation source file must have the extension \verb|.st |or \verb|.stt|. The \verb|.st| file is passed through the C preprocessor 
before it is processed by \verb|snc|.

If you have state notation language source files (\verb|.stt| and \verb|.st| files),  the module seq must be built and SNCSEQ defined 
in the RELEASE file. If the state notation language source files require c preprocessing before conversion to c source 
(\verb|.st| files), gcc must be in your path.

\subsection{Scripts, etc.}

\index{Scripts}
Any of the following can be specified:

\begin{description}

\item \index{SCRIPTS}\verb|SCRIPTS += <name>|

A script will be installed from the src directory to the \verb|$(INSTALL_LOCATION)/bin/<arch>| directories.

\item \verb|SCRIPTS_<osclass> += <name>|

Script \verb|<name>| will be installed for all archs of the specified osclass.

\item \verb|SCRIPTS_DEFAULT += <name>|

Script \verb|<name>| will be installed for any arch that does not have a \verb|SCRIPTS_<osclass>| definition

\item \index{SCRIPTS\_IOC}\verb|SCRIPTS_IOC += <name>|

Script \verb|<name>| will be installed for IOC type archs.

\item \verb|SCRIPTS_IOC_<osclass> += <name>|

Script \verb|<name>| will be installed for all IOC type archs of the specified osclass.

\item \verb|SCRIPTS_IOC_DEFAULT += <name>|

Script \verb|<name>| will be installed for any IOC type arch that does not have a \verb|SCRIPTS_IOC_<osclass>| 
definition

\item \index{SCRIPTS\_HOST}\verb|SCRIPTS_HOST += <name>|

Script \verb|<name>| will be installed for HOST type archs.

\item \verb|SCRIPTS_HOST_<osclass> += <name>|

Script \verb|<name>| will be installed for all HOST type archs of the specified osclass.

\item \verb|SCRIPTS_HOST_DEFAULT += <name>|

Script \verb|<name>| will be installed for any HOST type arch that does not have a \verb|SCRIPTS_HOST_<osclass>| 
definition

\end{description}

Definitions of the form:

\begin{verbatim}
SCRIPTS_<osclass> += <name1>
SCRIPTS_DEFAULT += <name2>
\end{verbatim}

results in the \verb|<name1>| script being installed from the src directory to the \verb|$(INSTALL_LOCATION)/bin/<arch>| 
directories for all target archs of the specified os class \verb|<osclass>| and the \verb|<name2>| script installed into the 
\verb|$(INSTALL_LOCATION)/bin/<arch>| directories of all other target archs.

\subsection{Include files}

\index{Include files}
A definition of the form:

\begin{verbatim}
INC += <name>.h
\end{verbatim}

\index{INC}results in file \verb|<name>.h| being installed or created and installed to the \$(INSTALL\_LOCATION)/include directory. 

Definitions of the form:

\begin{verbatim}
INC_DEFAULT += <name>.h
INC_<osclass> += <name>.h
\end{verbatim}

results in file \verb|<name>.h| being installed or created and installed into the appropriate \verb|$(INSTALL_LOCATION)/include/os/<osclass>| directory.

\subsection{Html and Doc files}

\index{Html}
\index{Doc file}
A definition of the form:

\begin{verbatim}
HTMLS_DIR = <dirname>
HTMLS += <name>
\end{verbatim}

\index{HTMLS}results in file \verb|<name>| being installed from the src directory to the \verb|$(INSTALL_LOCATION)/html/<dirname>| directory. 

A definition of the form:

\begin{verbatim}
DOCS += <name>
\end{verbatim}

\index{DOCS}results in file \verb|<name>| being installed from the src directory to the \$(INSTALL\_LOCATION)/doc directory. 

\subsection{Templates}

\index{Templates}
Adding definitions of the form

\begin{verbatim}
TEMPLATES_DIR = <dirname>
TEMPLATES += <name>
\end{verbatim}

\index{TEMPLATES}results in the file \verb|<name>| being installed from the src directory to the \verb|$(INSTALL_LOCATION)/templates/<dirname>| 
directory. If a directory structure of template files is to be installed, the template file names may include a directory prefix.

\subsection{Lex and yac}

\index{Lex and yac}
If a \verb|<name>.c| source file specified in a Makefile definition is not found in the source directory, gnumake will try to build 
it from \verb|<name>.y| and \verb|<name>_lex.l| files in the source directory. Lex converts a \verb|<name>.l| Lex code file to a lex.yy.c file 
which the build rules renames to \verb|<name>.c|. Yacc converts a \verb|<name>.y| yacc code file to a y.tab.c file, which the build 
rules renames to \verb|<name>.c|. Optionally yacc can create a y.tab.h file which the build rules renames to \verb|<name>.h|.

\subsection{Products}

\index{Products}
A product executable is created for each \verb|<arch>| and installed into \verb|$(INSTALL_LOCATION)/bin/<arch>| by specifying its 
name and the name of either the object or source files containing code for the product. An object or source file name can 
appear with or without a directory prefix. Object files should contain a directory prefix. If the file has a directory prefix 
e.g. \$(EPICS\_BASE\_BIN), the file is taken from the specified location. If a directory prefix is not present, make will look 
in the source directories for a file with the specified name or try build it using existing rules. An executable filename 
suffix appropriate for the target arch (e.g. .exe) may be appended to the filename when the file is created.

PROD specifications in the Makefile for vxWorks target architectures create a combined object file with library 
references resolved and a corresponding .munch file.

\begin{verbatim}
PROD_HOST += <name>
<name>_SRC += <srcname>.c
\end{verbatim}

results in the executable \verb|<name>| being built for each HOST architecture,  \verb|<arch>|, from a \verb|<srcname>.c| file. Then \verb|<name>| 
is installed into the \verb|$(INSTALL_LOCATION)/bin/<arch>| directory. 

\subsubsection{Specifying the product name.}

\index{product name}
Any of the following can be specified:

\begin{description}

\item \index{PROD}\verb|PROD += <name>|

Product \verb|<name>| will be created for every target arch.

\item \verb|PROD_<osclass> += <name>|

Product \verb|<name>| will be created for all archs of the specified osclass.

\item \verb|PROD_DEFAULT += <name>|

Product \verb|<name>| will be created for any arch that does not have a \verb|PROD_<osclass>| definition

\item

\item \index{PROD\_IOC}\verb|PROD_IOC += <name>|

Product \verb|<name>| will be created for IOC type archs.

\item \verb|PROD_IOC_<osclass> += <name>|

Product \verb|<name>| will be created for all IOC type archs of the specified osclass.

\item \verb|PROD_IOC_DEFAULT += <name>|

Product \verb|<name>| will be created for any IOC type arch that does not have a \verb|PROD_IOC_<osclass>| 
definition

\item

\item \index{PROD\_HOST}\verb|PROD_HOST += <name>|

Product \verb|<name>| will be created for HOST type archs.

\item \verb|PROD_HOST_<osclass> += <name>|

Product \verb|<name>| will be created for all HOST type archs of the specified osclass.

\item \verb|PROD_HOST_DEFAULT += <name>|

Product \verb|<name>| will be created for any HOST type arch that does not have a \verb|PROD_HOST_<osclass>| 
definition

\end{description}

\subsubsection{Specifying product object file names}

\index{product object file}
Object files which have filenames with a ``.o" or ``.obj" suffix are defined as follows and can be specified without the 
suffix but should have the directory prefix 

\begin{description}

\item \index{USR\_OBJS}\verb|USR_OBJS += <name>|

Object files will be used in builds of all products and libraries

\item \verb|USR_OBJS_<osclass> += <name>|

Object files will be used in builds of all products and libraries for archs with the specified osclass.

\item \verb|USR_OBJS_DEFAULT += <name>|

Object files will be used in builds of all products and libraries for archs without a \verb|USR_OBJS_<osclass>| 
definition specified.

\item \index{PROD\_OBJS}\verb|PROD_OBJS += <name>|

Object files will be used in builds of all products

\item \verb|PROD_OBJS_<osclass> += <name>|

Object files will be used in builds of all products for archs with the specified osclass.

\item \verb|PROD_OBJS_DEFAULT += <name>|

Object files will be used in builds of all products for archs without a \verb|PROD_OBJS_<osclass>| definition 
specified.

\item \index{name\_OBJS}\verb|<prodname>_OBJS += <name>|

Object files will be used for all builds of the named product

\item \verb|<prodname>_OBJS_<osclass> += <name>| 

Object files will be used in builds of the named product for archs with the specified osclass.

\item \verb|<prodname>_OBJS_DEFAULT += <name>|

Object files will be used in builds of the named product for archs without a \verb|<prodname>_OBJS_<osclass>| 
definition specified.

Combined object files, from R3.13 built modules and applications which have file names that do not include a ``.o" or 
".obj" suffix (e.g. xyzLib) are defined as follows:

\item \index{USR\_OBJLIBS}\verb|USR_OBJLIBS += <name>|

Combined object files will be used in builds of all libraries and products.

\item \verb|USR_OBJLIBS_<osclass> += <name>|

Combined object files will be used in builds of all libraries and products for archs of the specified osclass.

\item \verb|USR_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of all libraries and products for archs without a 
\verb|USR_OBJLIBS_<osclass>| definition specified.

\item

\item \index{PROD\_OBJLIBS}\verb|PROD_OBJLIBS += <name>|

Combined object files will be used in builds of all products.

\item \verb|PROD_OBJLIBS_<osclass> += <name>|

Combined object files will be used in builds of all products for archs of the specified osclass.

\item \verb|PROD_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of all products for archs without a \verb|PROD_OBJLIBS_<osclass>| 
definition specified.

\item

\item \index{name\_OBJLIBS}\verb|<prodname>_OBJLIBS += <name>|

Combined object files will be used for all builds of the named product.

\item \verb|<prodname>_OBJLIBS_<osclass> += <name>| 

Combined object files will be used in builds of the named product for archs with the specified osclass.

\item \verb|<prodname>_OBJLIBS_DEFAULT += <name>|

Combined object files will be used in builds of the named product for archs without a 
\verb|<prodname>_OBJLIBS_<osclass>| definition specified.



\item \index{name\_LDOBJS}\verb|<prodname>_LDOBJS += <name>|

Object files will be used for all builds of the named product. (deprecated)

\item \verb|<prodname>_LDOBJS_<osclass> += <name>| 

Object files will be used in builds of the name product for archs with the specified osclass. (deprecated)

\item \verb|<prodname>_LDOBJS_DEFAULT += <name>|

Object files will be used in builds of the product for archs without a \verb|<prodname>_LDOBJS_<osclass>| 
definition specified. (deprecated)

\end{description}

\subsubsection{Specifying product source file names}

\index{product source file}
Source file names, which must have a suffix, are defined as follows:

\begin{description}

\item \index{SRCS}\verb|SRCS += <name>|

Source files will be used for all defined libraries and products.

\item \verb|SRCS_<osclass> += <name>|

Source files will be used for all defined libraries and products for all archs of the specified osclass.

\item \verb|SRCS_DEFAULT += <name>|

Source files will be used for all defined libraries and products for any arch that does not have a 
\verb|SRCS_<osclass>| definition

\item

\item \index{USR\_SRCS}\verb|USR_SRCS += <name>|

Source files will be used for all products and libraries.

\item \verb|USR_SRCS_<osclass> += <name>|

Source files will be used for all defined products and libraries for all archs of the specified osclass.

\item \verb|USR_SRCS_DEFAULT += <name>|

Source files will be used for all defined products and libraries for any arch that does not have a 
\verb|USR_SRCS_<osclass>| definition

\item

\item \index{PROD\_SRCS}\verb|PROD_SRCS += <name>|

Source files will be used for all products.

\item \verb|PROD_SRCS_<osclass> += <name>|

Source files will be used for all defined products for all archs of the specified osclass.

\item \verb|PROD_SRCS_DEFAULT += <name>|

Source files will be used for all defined products for any arch that does not have a \verb|PROD_SRCS_<osclass>| 
definition

\item

\item \index{name\_SRCS}\verb|<prodname>_SRCS += <name>|

Source file will be used for the named product.

\item \verb|<prodname>_SRCS_<osclass> += <name>|

Source files will be used for named product for all archs of the specified osclass.

\item \verb|<prodname>_SRCS_DEFAULT += <name>|

Source files will be used for named product for any arch that does not have a \verb|<prodname>_SRCS_<osclass>| 
definition

\end{description}

\subsubsection{Specifying libraries to be linked when creating the product}

\index{Specifying libraries}
\index{product libraries}
For each library name specified which is not a system library nor a library from EPICS\_BASE, a \verb|<name>_DIR| definition 
must be present in the Makefile to specify the location of the library. 

Library names, which must not have a directory and ``lib" prefix nor a suffix, are defined as follows:

\begin{description}

\item \index{PROD\_LIBS}\verb|PROD_LIBS += <name>|

Libraries to be used when linking all defined products.

\item \verb|PROD_LIBS_<osclass> += <name>|

Libraries to be used or all archs of the specified osclass when linking all defined products.

\item \verb|PROD_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|PROD_LIBS_<osclass>| definition when linking all 
defined products.

\item

\item \index{USR\_LIBS}\verb|USR_LIBS += <name>|

Libraries to be used when linking all defined products.

\item \verb|USR_LIBS_<osclass> += <name>|

Libraries to be used or all archs of the specified osclasswhen linking all defined products.

\item \verb|USR_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|USR_LIBS_<osclass>| definition when linking all 
defined products.

\item \index{name\_LIBS}\verb|<prodname>_LIBS += <name>|

Libraries to be used for linking the named product.

\item \verb|<prodname>_LIBS_<osclass> += <name>|

Libraries will be used for all archs of the specified osclass for linking named product.

\item \verb|<prodname>_LIBS_DEFAULT += <name>|

Libraries to be used for any arch that does not have a \verb|<prodname>_LIBS_<osclass>| definition when linking 
named product.

\item

\item \index{SYS\_PROD\_LIBS}\verb|SYS_PROD_LIBS += <name>|

System libraries to be used when linking all defined products.

\item \verb|SYS_PROD_LIBS_<osclass> += <name>|

System libraries to be used for all archs of the specified osclass when linking all defined products.

\item \verb|SYS_PROD_LIBS_DEFAULT += <name>|

System libraries to be used for any arch that does not have a \verb|PROD_LIBS_<osclass>| definition when 
linking all defined products.

\item \index{name\_SYS\_LIBS}\verb|<prodname>_SYS_LIBS += <name>|

System libraries to be used for linking the named product.

\item

\item \verb|<prodname>_SYS_LIBS_<osclass> += <name>|

System libraries will be used for all archs of the specified osclass for linking named product.

\item \verb|<prodname>_SYS_LIBS_DEFAULT += <name>|

System libraries to be used for any arch that does not have a \verb|<prodname>_LIBS_<osclass>| definition when 
linking named product.

\end{description}

\subsubsection{The order of dependant libraries}

\index{Product link order}
Dependant library names appear in the following order on a product link line:

\begin{enumerate}
\item \index{name\_LIBS}\verb|<prodname>_LIBS|

\item \verb|<prodname>_LIBS_<osclass>| or \verb|<prodname>_LIBS_DEFAULT|

\item \index{PROD\_LIBS}\verb|PROD_LIBS|

\item \verb|PROD_LIBS_<osclass>| or \verb|PROD_LIBS_DEFAULT|

\item \index{USR\_LIBS}\verb|USR_LIBS|

\item \verb|USR_LIBS_<osclass>| or \verb|USR_LIBS_DEFAULT|

\item \index{name\_SYS\_LIBS}\verb|<prodname>_SYS_LIBS|

\item \verb|<prodname>_SYS_LIBS_<osclass>| or \verb|<prodname>_SYS_LIBS_DEFAULT|

\item \index{PROD\_SYS\_LIBS}\verb|PROD_SYS_LIBS|

\item \verb|PROD_SYS_LIBS_<osclass>| or \verb|PROD_SYS_LIBS_DEFAULT|

\item \index{USR\_SYS\_LIBS}\verb|USR_SYS_LIBS|

\item \verb|USR_SYS_LIBS_<osclass>| or \verb|USR_SYS_LIBS_DEFAULT|

\end{enumerate}

\subsubsection{Specifying product version number}

\index{product version number}
On WIN32 only a product version number can be specified as follows:

\begin{description}
\item \index{PROD\_VERSION}\verb|PROD_VERSION += <version>|

\end{description}

This results in ``/version:\$(PROD\_VERSION)" link option.

\subsubsection{Generate version header}

A header can be generated which defines a single string macro with an automatically generated identifier.
The default is the ISO 8601 formatted time of the build.
A revision id is used if a supported version control system is present.
This will typically be used to make an automatically updated source version number visible at runtime (eg. with a stringin record).

To enable this the variable \index{GENVERSION}\verb|GENVERSION| must be set with the desired name of the generated header.
By default this variable is empty and no header will be generated.
If specified, this variable must be set before \verb|configure/RULES| is included.

It is also necessary to add an explicit dependency for each source file which includes the generated header.

An Makefile which generates a version header named ``myversion.h'' included by ``devVersionString.c'' would have the following.

\begin{verbatim}
TOP=../..
include $(TOP)/configure/CONFIG
# ... define PROD or LIBRARY names sometarget
sometarget_SRCS = devVersionString.c
GENVERSION = myversion.h
include $(TOP)/configure/RULES
# for each source file
devVersionString$(DEP): $(GENVERSION)
\end{verbatim}

The optional variables \index{GENVERSIONMACRO}\verb|GENVERSIONMACRO| and \index{GENVERSIONDEFAULT}\verb|GENVERSIONDEFAULT| give the name of the C macro which will be defined in the generated header, and its default value if no version control system is being used.
To avoid conflicts, the macro name must be changed from its default \verb|MODULEVERSION| if the version header is to be installed.

\subsubsection{Product static builds}

\index{static builds}
\index{product version number}
Product executables can be linked with either archive versions or shared versions of EPICS libraries. Shared versions of 
system libraries will always be used in product linking. The definition of \index{STATIC\_BUILD}STATIC\_BUILD (YES/NO) in base/configure/
CONFIG\_SITE determines which EPICS libraries to use. When STATIC\_BUILD is NO, shared libraries will be used.  
(\index{SHARED\_LIBRARIES}SHARED\_LIBRARIES must be set to YES.) The default definition for STATIC\_BUILD in the EPICS base 
CONFIG\_SITE distribution file is NO. A STATIC\_BUILD definition in a Makefile will \index{override}override the definition in 
CONFIG\_SITE.Static builds may not be possible on all systems. For static builds, all nonsystem libraries must have an 
archive version, and this may not be true form all libraries.

\subsection{Test Products}

\index{Test Products}
Test products are product executables that are created but not installed into \verb|$(INSTALL_LOCATION)/bin/<arch>| 
directories. Test product libraries, source, and object files are specified in exactly the same way as regular products. 

Any of the following can be specified:

\begin{description}

\item \index{TESTPROD}\verb|TESTPROD += <name>|

Test product \verb|<name>| will be created for every target arch.

\item \verb|TESTPROD_<osclass> += <name>|

Test product \verb|<name>| will be created for all archs of the specified osclass.

\item \verb|TESTPROD_DEFAULT += <name>|

Test product \verb|<name>| will be created for any arch that does not have a \\
\verb|TESTPROD_<osclass>| definition

\item

\item \index{TESTPROD\_IOC}\verb|TESTPROD_IOC += <name>|

Test product \verb|<name>| will be created for IOC type archs.

\item \verb|TESTPROD_IOC_<osclass> += <name>|

Test product \verb|<name>| will be created for all IOC type archs of the specified osclass.

\item \verb|TESTPROD_IOC_DEFAULT += <name>|

Test product \verb|<name>| will be created for any IOC type arch that does not have a \\
\verb|TESTPROD_IOC_<osclass>| definition

\item

\item \index{TESTPROD\_HOST}\verb|TESTPROD_HOST += <name>|

Test product \verb|<name>| will be created for HOST type archs.

\item \verb|TESTPROD_HOST_<osclass> += <name>|

Test product \verb|<name>| will be created for all HOST type archs of the specified osclass.

\item \verb|TESTPROD_HOST_DEFAULT += <name>|

Test product \verb|<name>| will be created for any HOST type arch that does not have a \\
\verb|TESTPROD_HOST_<osclass>| definition

\end{description}

\subsection{Test Scripts}

\index{Test Scripts}
Test scripts are perl scripts whose names end in \verb|.t| that get executed to satisfy the \verb|runtests| make target. They are run 
by the perl Test::Harness library, and should send output to stdout following the Test Anything Protocol. Any of the 
following can be specified, although only TESTSCRIPTS\_HOST is currently useful:

\begin{description}

\item \index{TESTSCRIPTS}\verb|TESTSCRIPTS += <name>|

Test script \verb|<name>| will be created for every target arch.

\item \verb|TESTSCRIPTS_<osclass> += <name>|

Test script \verb|<name>| will be created for all archs of the specified osclass.

\item \verb|TESTSCRIPTS_DEFAULT += <name>|

Test script \verb|<name>| will be created for any arch that does not have a \\
\verb|TESTSCRIPTS_<osclass>| definition

\item 

\item \index{TESTSCRIPTS\_IOC}\verb|TESTSCRIPTS_IOC += <name>|

Test script \verb|<name>| will be created for IOC type archs.

\item \verb|TESTSCRIPTS_IOC_<osclass> += <name>|

Test script \verb|<name>| will be created for all IOC type archs of the specified osclass.

\item \verb|TESTSCRIPTS_IOC_DEFAULT += <name>|

Test script \verb|<name>| will be created for any IOC type arch that does not have a \\
\verb|TESTSCRIPTS_IOC_<osclass>| definition

\item

\item \index{TESTSCRIPTS\_HOST}\verb|TESTSCRIPTS_HOST += <name>|

Test script \verb|<name>| will be created for HOST type archs.

\item \verb|TESTSCRIPTS_HOST_<osclass> += <name>|

Test script \verb|<name>| will be created for all HOST type archs of the specified osclass.

\item \verb|TESTSCRIPTS_HOST_DEFAULT += <name>|

Test script \verb|<name>| will be created for any HOST type arch that does not have a \\
\verb|TESTSCRIPTS_HOST_<osclass>| definition.

\end{description}

If a name in one of the above variables matches a regular executable program name (normally generated as a test product) 
with ``\verb|.t|" appended, a suitable perl script will be generated that will execute that program directly; this makes it simple to 
run programs that use the epicsUnitTest routines in libCom.  A test script written in Perl with a name ending \verb|.plt| will be 
copied into the \verb|O.<arch>| directory with the ending changed to \verb|.t|; such scripts will usually use the perl Test::Simple or 
Test::More libraries.

\subsection{Miscellaneous Targets}

A definition of the form:

\begin{verbatim}
TARGETS += <name>
\end{verbatim}

\index{TARGETS}results in the file \verb|<name>| being built in the \verb|O.<arch>| directory from existing rules and files in the source directory. These 
target files are not installed.

\subsection{Installing Other Binaries}

\index{Installing Other Binaries}
Definitions of the form:

\begin{verbatim}
BIN_INSTALLS += <name>
BIN_INSTALLS += <dir>/<name>
BIN_INSTALLS_DEFAULT += <name>
BIN_INSTALLS_<osclass> += <name>
\end{verbatim}

\index{BIN\_INSTALLS}will result in the named files being installed to the appropriate \verb|$(INSTALL_LOCATION)/bin/<arch>| directory. The file 
\verb|<name>| can appear with or without a directory prefix. If the file has a directory prefix e.g. \$(EPICS\_BASE\_BIN), it is 
copied from the specified location. If a directory prefix is not present, make will look in the source directory for the file.

\subsection{Installing Other Libraries}

\index{Installing Other Libraries}
Definitions of the form:

\begin{verbatim}
LIB_INSTALLS += <name>
LIB_INSTALLS += <dir>/<name>
LIB_INSTALLS_DEFAULT += <name>
LIB_INSTALLS_<osclass> += <name>
\end{verbatim}

\index{LIB\_INSTALLS}result in files being installed to the appropriate \verb|$(INSTALL_LOCATION)/lib/<arch>| directory. The file \verb|<name>| can 
appear with or without a directory prefix. If the file has a directory prefix e.g. \$(EPICS\_BASE\_LIB), it is copied from the 
specified location. If a directory prefix is not present, make will look in the source directory for the file.

\subsection{Win32 resource files}

\index{resource files}
Definitions of the form:

\noindent\verb|RCS += <name>   |Resource definition script files for all products and libraries.\\
\verb|RCS_<osclass> += <name>|\\
\verb||\\
\verb|PROD_RCS += <name> |Resource definition script files for all products.\\
\verb|PROD_RCS_<osclass> += <name>|\\
\verb|PROD_RCS_DEFAULT += <name>|\\
\verb||\\
\verb|LIB_RCS += <name> |Resource definition script files for all libraries.\\
\verb|LIB_RCS_<osclass> += <name>|\\
\verb|LIB_RCS_DEFAULT += <name>|\\
\verb||\\
\verb|<name>_RCS += <name> |Resource definition script files for specified product or library.\\
\verb|<name>_RCS_<osclass> += <name>|\\
\verb|<name>_RCS_DEFAULT += <name>|\\
\verb||\\
\index{RCS}
\index{PROD\_RCS}
\index{LIB\_RCS}
\index{name\_RCS}
result in resource files (*.res files) being created from the specified *.rc resource definition script files and linked into the 
prods and/or libraries.

\subsection{TCL libraries}

\index{TCL libraries}
Definitions of the form:

\begin{verbatim}
TCLLIBNAME += <name>
TCLINDEX += <name>
\end{verbatim}

\index{TCLLIBNAME}
\index{TCLINDEX}
result in the specified tcl files being installed to the \verb|$(INSTALL_LOCATION)/lib/<arch>| directory.

\subsection{Java class files}

\index{Java class files}
Java class files can be created by the javac tool into \$(INSTALL\_JAVA) or into the \verb|O.Common| subdirectory, by 
specifying the name of the java class file in the Makefile. Command line options for the javac tool can be specified. The 
configuration files set the java c option ``\verb|-sourcepath .:..:../..|".

Any of the following can be specified:

\begin{description}

\item \index{JAVA}\verb|JAVA += <name>.java|

The \verb|<name>.java| file will be used to create the \verb|<name>.class| file in the \$(INSTALL\_JAVA) directory.

\item \index{TESTJAVA}\verb|TESTJAVA += <name>.java|

The \verb|<name>.java| files will be used to create the \verb|<name>.class| file in the \verb|O.Common| subdirectory.

\item \index{USR\_JAVACFLAGS}\verb|USR_JAVACFLAGS += <name>|

The javac option \verb|<name>| will be used on the javac command lines.

\end{description}

\subsubsection{Example 1}

\index{Java Example}
In this example, three class files are created in \$(INSTALL\_LOCATION)/javalib/mytest. The javac depreciation flag is 
used to list the description of each use or override of a deprecated member or class.

\begin{description}

\item \index{JAVA}JAVA = mytest/one.java

\item JAVA = mytest/two.java

\item JAVA = mytest/three.java

\item \index{USR\_JAVACFLAGS}USR\_JAVACFLAGS = -deprecation

\end{description}

\subsubsection{Example 2}

In this example, the test.class file is created in the \verb|O.Common| subdirectory.

\begin{description}

\item \index{TESTJAVA}TESTJAVA = test.java

\end{description}

\subsection{Java jar file}

\index{Java jar file}
A single java jar file can be created using the java jar tool and installed into \$(INSTALL\_JAVA) \\
(i.e. \$(INSTALL\_LOCATION)/javalib) by specifying its name, and the names of its input files to be included in the created jar 
file. The jar input file names must appear with a directory prefix.

Any of the following can be specified:

\begin{description}

\item \index{JAR}\verb|JAR += <name>|

The \verb|<name>| jar file will be created and installed into the \$(INSTALL\_JAVA) directory.

\item \index{JAR\_INPUT}\verb|JAR_INPUT += <name>|

Names of images, audio files and classes files to be included in the jar file.

\item \index{JAR\_MANIFEST}\verb|JAR_MANIFEST += <name>|

The preexisting manifest file will be used for the created jar file.

\item \verb|JAR_PACKAGES += <name>|

Names of java packages to be installed and added to the created jar file.

\end{description}

\subsubsection{Example 1}

In this example, all the class files created by the current Makefile's ``JAVA+=" definitions, are placed into a file named 
mytest1.jar. A manifest file will be automatically generated for the jar. 

Note: \$(INSTALL\_CLASSES) is set to \$(addprefix \$(INSTALL\_JAVA)/,\$(CLASSES)) in the EPICS base configure 
files.

\begin{description}

\item \index{JAR}JAR = mytest1.jar

\item \index{JAR\_INPUT}JAR\_INPUT = \$(INSTALL\_CLASSES)

\end{description}

\subsubsection{Example 2}

In this example, three class files are created and placed into a new jar archive file named mytest2.jar. An existing manifest 
file, mytest2.mf is put into the new jar file.

\begin{description}

\item JAR = mytest2.jar

\item JAR\_INPUT = \$(INSTALL\_JAVA)/mytest/one.class

\item JAR\_INPUT = \$(INSTALL\_JAVA)/mytest/two.class

\item JAR\_INPUT = \$(INSTALL\_JAVA)/mytest/three.class

\item JAR\_MANIFEST = mytest2.mf

\end{description}

\subsection{Java native method C header files}

\index{Java native methods}
A C header files for use with java native methods will be created by the javah tool in the \verb|O.Common| subdirectory by 
specifying the name of the header file to be created. The name of the java class file used to generate the header is derived 
from the name of the header file. Underscores (\_) are used as a header file name delimiter. Command line options for the 
javah tool can be specified.

Any of the following can be specified:

\begin{description}

\item \index{JAVAINC}\verb|JAVAINC += <name>.h|

The \verb|<name>.h| header file will be created in the \verb|O.Common| subdirectory.

\item \index{USR\_JAVAHFLAGS}\verb|USR_JAVAHFLAGS += <name>|

The javah option \verb|<name>| will be used on the javah tool command line.

\end{description}

\subsubsection{Example}

In this example, the C header xx\_yy\_zz.h will be created in the \$(COMMON\_DIR) subdirectory from the class xx.yy.zz 
(i.e. the java class file \$(INSTALL\_JAVA)/xx/yy/zz.class)). The option ``-old" will tell javah to create old JDK1.0 style 
header files.

\begin{description}
\item \verb|JAVAINC = xx_yy_zz.h|

\item \verb|USR_JAVAHFLAGS = -old|

\end{description}

\subsection{User Created CONFIG* and RULES* files}

\index{User created config files}
\index{CONFIG files, user created}
\index{RULES files, user created}
Module developers can now create new CONFIG and RULES* files ia a \verb|<top>| application source directory. These new 
CONFIG* or RULES* files will be installed into the directory \$(INSTALL\_LOCATION)/cfg by including lines like the 
following Makefile line:

\begin{description}
\item \index{CFG}\verb|CFG += CONFIG_MY1 RULES_MY1|

\end{description}

The build will install the new files \verb|CONFIG_MY1| and \verb|RULES_MY1| into the \$(INSTALL\_LOCATION)/cfg directory.

Files in a \$(INSTALL\_LOCATION)/cfg directory are now included during a build by so that the definitions and rules in 
them are available for use by later src directory Makefiles in the same module or by other modules with a RELEASE line 
pointing to the TOP of this module.

\subsection{User Created File Types}

\index{File types, user created}
\index{File Types}
Module developers can now define a new type of file, e.g. ABC, so that files of type ABC will be installed into a directory 
defined by INSTALL\_ABC. This is done by creating a new \verb|CONFIG_<name>| file, e.g. CONFIG\_ABC, with the 
following lines:

\begin{description}
\item \index{FILE\_TYPE}FILE\_TYPE += ABC

\item INSTALL\_ABC = \$(INSTALL\_LOCATION)/abc

\end{description}

The INSTALL\_ABC directory should be a subdirectory of \$(INSTALL\_LOCATION). The file type ABC should be 
target architecture independent (alh files, medm files, edm files.

Optional rules necessary for files of type ABC should be put in a RULES\_ABC file.

The module developer installs new CONFIG\_ABC and RULES\_ABC files for the new file type into the directory 
\$(INSTALL\_LOCATION)/cfg by including the following Makefile line:

\begin{description}
\item \index{CFG}CFG += CONFIG\_ABC RULES\_ABC

\end{description}

Files of type ABC are installed into INSTALL\_ABC directory by adding a line like the following to a Makefile.

\begin{description}
\item \verb|ABC += <filename1> <filename2> <filename3>|

\end{description}

Since the files in \$(INSTALL\_LOCATION)/cfg directory are now included by the base config files, the ABC += 
definition lines are available for use by later src directory Makefiles in the same module or by other modules with a 
RELEASE line pointing to the TOP of this module.

\subsection{Assemblies}

\index{Assemblies}
A single output file is generated from assembling specified snippet files.
Snippet file names start with numbers and are sorted when the snippets are concatenated:
first by the number, then alphabetical by the remaining part of the name.
(This mechanism is conceptually similar to the Linux convention of collecting configuration file snippets
in *.d directories.)

Snippets with file names not starting with a number or ending in '\textasciitilde' are ignored. 
The specified snippets are processed in the order they appear on the command line.
Multiple snippets with the same number are concatenated.
"Commands" (tags in the snippet name) can be used to control the treatment of snippets with
the same number:

\begin{description}
\item D - Default\\
Snippet is treated as a default, which is replaced (overwritten) by any other snippet with
the same number.

\item R - Replace\\
Snippet is replacing (overwriting) already processed snippets with the same number.

\end{description}

Specification of the target file is different for architecture dependent or independent files.

\begin{description}
\item \index{COMMON\_ASSEMBLIES}\verb|COMMON_ASSEMBLIES += st.cmd|
\item \index{ASSEMBLIES}\verb|ASSEMBLIES += mytool.rc|

\end{description}

Snippet files are configured specifically (relative or absolute path) or as patterns
(searched relative to all source directories).

\begin{description}
\item \verb|mytool.rc_SNIPPETS += ../rc.d/10_head ../rc.d/20_init|
\item \verb|st.cmd_PATTERN += st.cmd.d/*|

\end{description}

\subsubsection{Macros}
The following macros can be used in snippets, and will be replaced by the current value
when assembling is done.

\begin{description}
\item \verb|_DATETIME_|
Date and time of the build

\item \verb|_USERNAME_|
Name of the user running the build

\item \verb|_HOST_|
Name of the host on which the build is run

\item \verb|_OUTPUTFILE_|
Name of the generated file

\item \verb|_SNIPPETFILE_|
Name of the current snippet

\end{description}

\subsubsection{Example}
This mechanism can be used to create an IOC startup file from snippets in a global and
an application specific directory, allowing applications to add commands to different phases
of the IOC startup by dropping appropriately numbered snippets into the directory.

Given the following directories and snippets:

\begin{verbatim}
/global/st.cmd.d:   (G=GLOBAL)
    D10_init
    20_environment
    30_drivers
    D40_settings
    70_start-ioc
\end{verbatim}

\begin{verbatim}
../st.cmd.d:        (L=LOCAL)
    D10_init
    40_settings
    40_settings~
    30_another-driver
    R70_start-my-ioc
\end{verbatim}

And the following Makefile declaration:

\begin{verbatim}
SCRIPTS += $(COMMON_DIR)/st.cmd
COMMON_ASSEMBLIES += st.cmd
st.cmd_SNIPPETS += $(wildcard /global/st.cmd.d/*)
st.cmd_PATTERN += st.cmd.d/*
\end{verbatim}

The build will create and install a \verb|st.cmd| script using the following snippets: 

\begin{tabular}{lll}
\textbf{Source} & \textbf{Snippet} & \textbf{Comment} \\ \hline
L & \verb|10_init|            & L default resets the G default \\
G & \verb|20_environment|     & \\
L & \verb|30_another-driver|  & implicit addition, alphabetical sorting \\
G & \verb|30_drivers|         & \\
L & \verb|40_settings|        & replacing a default, ignoring backup file \\
L & \verb|70_start-my-ioc|    & explicit replace \\
\end{tabular}

\section{Table of Makefile definitions}

\index{Table of Makefile definitions}
Definitions given below containing \verb|<osclass>| are used when building for target archs of a specific \index{osclass}osclass, and the 
\verb|<osclass>| part of the name should be replaced by the desired osclass, e.g. solaris, vxWorks, etc. If a \verb|_DEFAULT| setting is 
given but a particular \verb|<osclass>| requires that the default not apply and there are no items in the definition that apply for 
that \verb|<osclass>|, the value ``\verb|-nil-|" should be specified in the relevant Makefile definition.
\begin{center}
\begin{longtable}
{p{2.94784in}p{3.76247in}}
\textbf{Build Option} & \textbf{Description}\\
\hline \hline
\textbf{Products to be built (host type archs only)} & \\
\hline
\verb|PROD| & products (names without execution suffix) to build and install. Specify xyz to build executable xyz on Unix and xyz.exe on WIN32\\
\verb|PROD_<osclass>| & os class specific products to build and install for \verb|<osclass>| archs only\\
\verb|PROD_DEFAULT| & products to build and install for archs with no \verb|PROD_<osclass>| specified\\
\verb|PROD_IOC| & products to build and install for ioc type archs\\
\verb|PROD_IOC_<osclass>| & os specific products to build and install for ioc type archs\\
\verb|PROD_IOC_DEFAULT| & products to build and install for ioc type arch systems with no \verb|PROD_IOC_<osclass>| specified\\
\verb|PROD_HOST| & products to build and install for host type archs. \\
\verb|PROD_HOST_<osclass>| & os class specific products to build and install for \verb|<osclass>| type archs\\
\verb|PROD_HOST_DEFAULT| & products to build and install for arch with no \verb|PROD_HOST_<osclass>| specified\\
\textbf{Test products to be built} & \\
\hline
\verb|TESTPROD| & test products (names without execution suffix) to build but not install \\
\verb|TESTPROD_<osclass>| & os class specific test products to build but not install\\
\verb|TESTPROD_DEFAULT| & test products to build but not install for archs with no \verb|TESTPROD_<osclass>| specified\\
\verb|TESTPROD_IOC| & test products to build and install for ioc type archs\\
\verb|TESTPROD_IOC_<osclass>| & os specific test products to build and install for ioc type archs\\
\verb|TESTPROD_IOC_DEFAULT| & test products to build and install for ioc type arch systems with no \verb|TESTPROD_IOC_<osclass>| specified\\
\verb|TESTPROD_HOST| & testproducts to build and install for host type archs. \\
\verb|TESTPROD_HOST_<osclass>| & os class specific testproducts to build and install for \verb|<osclass>| type archs\\
\verb|TESTPROD_HOST_DEFAULT| & test products to build and install for arch with no \verb|TESTPROD_HOST_<osclass>| specified\\
\textbf{Test scripts to be built} & \\
\hline
\verb|TESTSCRIPTS| & test scripts (names with .t suffix) to build but not install\\
\verb|TESTSCRIPTS_<osclass>| & os class specific test scripts to build but not install\\
\verb|TESTSCRIPTS_DEFAULT| & test scripts to build but not install for archs with no \verb|TESTSCRIPTS_<osclass>| specified\\
\verb|TESTSCRIPTS_IOC| & test scripts to build and install for ioc type archs\\
\verb|TESTSCRIPTS_IOC_<osclass>| & os specific test scripts to build and install for ioc type archs\\
\verb|TESTSCRIPTS_IOC_DEFAULT| & test scripts to build and install for ioc type arch systems with no \verb|TESTSCRIPTS_IOC_<osclass>| specified\\
\verb|TESTSCRIPTS_HOST| & test scripts to build and install for host type archs. \\
\verb|TESTSCRIPTS_HOST_<osclass>| & os class specific testscripts to build and install for \verb|<osclass>| type archs\\
\verb|TESTSCRIPTS_HOST_DEFAULT| & test scripts to build and install for arch with no \verb|TESTSCRIPTS_HOST_<osclass>| specified\\
\textbf{Libraries to be built} & \\
\hline
\verb|LIBRARY| & name of library to build and install. The name should NOT include a prefix or extension e.g. specify Ca to build libCa.a on Unix, Ca.lib or Ca.dll on WIN32\\
\verb|LIBRARY_<osclass>| & os specific libraries to build and install\\
\verb|LIBRARY_DEFAULT| & libraries to build and install for archs with no \verb|LIBRARY_<osclass>| specified\\
\verb|LIBRARY_IOC| & name of library to build and install for ioc type archs. The name should NOT include a prefix or extension e.g. specify Ca to build libCa.a on Unix, Ca.lib or Ca.dll on WIN32\\
\verb|LIBRARY_IOC_<osclass>| & os specific libraries to build and install for ioc type archs\\
\verb|LIBRARY_IOC_DEFAULT| & libraries to build and install for ioc type arch systems with no \verb|LIBRARY_IOC_<osclass>| specified\\
\verb|LIBRARY_HOST| & name of library to build and install for host type archs. The name should NOT include a prefix or extension, e.g. specify Ca to build libCa.a on Unix, Ca.lib or Ca.dll on WIN32\\
\verb|LIBRARY_HOST_<osclass>| & os class specific libraries to build and install for host type archs\\
\verb|LIBRARY_HOST_DEFAULT| & libraries to build and install for host type arch systems with no \verb|LIBRARY_HOST_<osclass>| specified\\
\verb|SHARED_LIBRARIES| & build shared libraries? Must be YES or NO\\
\verb|SHRLIB_VERSION| & shared library version number\\
\textbf{Loadable libraries to be built} & \\
\hline
\verb|LOADABLE_LIBRARY| & name of loadable library to build and install. The name should NOT include a prefix or extension e.g. specify Ca to build libCa.so on Unix and Ca.dll on WIN32\\
\verb|LOADABLE_LIBRARY_<osclass>| & os specific loadable libraries to build and install\\
\verb|LOADABLE_LIBRARY_DEFAULT| & loadable libraries to build and install for archs with no \verb|LOADABLE_LIBRARY_<osclass>| specified\\
\verb|LOADABLE_LIBRARY_HOST| & name of loadable library to build and install for host type archs. The name should NOT include a prefix or extension, e.g. specify test to build libtest.so on Unix and test.dll on WIN32\\
\verb|LOADABLE_LIBRARY_HOST_<osclass>| & os class specific loadable libraries to build and install for host type archs\\
\verb|LOADABLE_LIBRARY_HOST_DEFAULT| & loadable libraries to build and install for host type arch systems with no \verb|LOADABLE_LIBRARY_HOST_<osclass>| specified\\
\textbf{Combined object files (vxWorks only)} & \\
\hline
\verb|OBJLIB| & name of a combined object file library and corresponding munch file to build and install. The name will have a Library suffix appended\\
\verb|OBJLIB_vxWorks| & same as OBJLIB\\
\verb|OBJLIB_SRCS| & source files to build the OBJLIB\\
\verb|OBJLIB_OBJS| & object files to include in OBJLIB\\
\textbf{Product and library source files} & \\
\hline
\verb|SRCS| & source files to build all PRODs and LIBRARYs\\
\verb|SRCS_<osclass>| & osclass specific source files to build all PRODs and LIBRARYs\\
\verb|SRCS_DEFAULT| & source file to build all PRODs and LIBRARYs for archs with no \verb|SRCS_<osclass>| specified\\
\verb|USR_SRCS| & source files to build all PRODs and LIBRARYs\\
\verb|USR_SRCS_<osclass>| & osclass specific source files to build all PRODs and LIBRARYs\\
\verb|USR_SRCS_DEFAULT| & source file to build all PRODs and LIBRARYs for archs with no \verb|SRCS_<osclass>| specified\\
\verb|PROD_SRCS| & source files to build all PRODs\\
\verb|PROD_SRCS_<osclass>| & osclass specific source files to build all PRODs\\
\verb|PROD_SRCS_DEFAULT| & source files needed to build PRODs for archs with no \verb|SRCS_<osclass>| specified\\
\verb|LIB_SRCS| & source files for building LIBRARY (e.g. LIB\_SRCS=la.c lb.c lc.c)\\
\verb|LIB_SRCS_<osclass>| & os-specific library source files\\
\verb|LIB_SRCS_DEFAULT| & library source files for archs with no \verb|LIB_SRCS_<osclass>| specified\\
\verb|LIBSRCS| & source files for building LIBRARY (deprecated)\\
\verb|LIBSRCS_<osclass>| & os-specific library source files (deprecated)\\
\verb|LIBSRCS_DEFAULT| & library source files for archs with no \verb|LIBSRCS_<osclass>| specified (deprecated)\\
\verb|<name>_SRCS| & source files to build a specific PROD or LIBRARY\\
\verb|<name>_SRCS_<osclass>| & os specific source files to build a specific PROD or LIBRARY\\
\verb|<name>_SRCS_DEFAULT| & source files needed to build a specific PROD or LIBRARY for archs with no \verb|<prod>_SRCS_<osclass>| specified\\
\textbf{Product and library object files} & \\
\hline
\verb|USR_OBJS| & object files, specified without suffix, to build all PRODs and LIBRARYs\\
\verb|USR_OBJS_<osclass>| & osclass specific object files, specified without suffix, to build all PRODs and LIBRARYs\\
\verb|USR_OBJS_DEFAULT| & object files, specified without suffix, needed to build PRODs and LIBRARYs for archs with no \verb|OBJS_<osclass>| specified\\
\verb|PROD_OBJS| & object files, specified without suffix, to build all PRODs\\
\verb|PROD_OBJS_<osclass>| & osclass specific object files, specified without suffix, to build all PRODs\\
\verb|PROD_OBJS_DEFAULT| & object files, specified without suffix, needed to build PRODs for archs with no \verb|OBJS_<osclass>| specified\\
\verb|LIB_OBJS| & object files, specified without suffix, for building all LIBRARYs (e.g. LIB\_OBJS+=\$(AB\_BIN)/la \$(AB\_BIN)/lb)\\
\verb|LIB_OBJS_<osclass>| & os-specific library object files, specify without suffix,\\
\verb|LIB_OBJS_DEFAULT| & library object files, specified without suffix, for archs with no \verb|LIB_OBJS_<osclass>| specified\\
\verb|<name>_OBJS| & object files, specified without suffix, to build a specific PROD or LIBRARY\\
\verb|<name>_OBJS_<osclass>| & os specific object files, specified without suffix, to build a specific PROD or LI\textbar{}BRARY\\
\verb|<name>_OBJS_DEFAULT| & object files, without suffix, needed to build a specific PROD or LIBRARY for archs with no \verb|<prod>_OBJS_<osclass>| specified\\
\textbf{Product and library R3.13 combined object files} & \\
\hline
\verb|USR_OBJLIBS| & combined object files with filenames that do not have a suffix, needed for building all PRODs and LIBRARYs (e.g. USR\_OBJLIBS+=\$(XYZ\_BIN)/xyzLib)\\
\verb|USR_OBJLIBS_<osclass>| & os-specific combined object files with filenames that do not have a suffix for building all PRODs and LIBRARYs\\
\verb|USR_OBJLIBS_DEFAULT| & combined object files with filenames that do not have a suffix, for archs with no \verb|USR_OBJLIBS_<osclass>| specified for building all PRODs and LIBRARYs\\
\verb|PROD_OBJLIBS| & combined object files with filenames that do not have a suffix, needed for building all PRODs (e.g. PROD\_OBJLIBS+=\$(XYZ\_BIN)/xyzLib)\\
\verb|PROD_OBJLIBS_<osclass>| & os-specific combined object files with filenames that do not have a suffix for building all PRODs\\
\verb|PROD_OBJLIBS_DEFAULT| & combined object files with filenames that do not have a suffix, for archs with no \verb|PROD_OBJLIBS_<osclass>| specified for building all PRODs\\
\verb|LIB_OBJLIBS| & combined object files with filenames that do not have a suffix, needed for building all LIBRARYs (e.g. LIB\_OBJLIBS+=\$(XYZ\_BIN)/xyzLib)\\
\verb|LIB_OBJLIBS_<osclass>| & os-specific combined object files with filenames that do not have a suffix for building all LIBRARYs\\
\verb|LIB_OBJLIBS_DEFAULT| & combined object files with filenames that do not have a suffix, for archs with no \verb|LIB_OBJLIBS_<osclass>| specified for building all LIBRARYs\\
\verb|<name>_OBJLIBS| & combined object files with filenames that do not have a suffix, needed to build a specific PROD or LIBRARY\\
\verb|<name>_OBJLIBS_<osclass>| & os specific combined object files with filenames that do not have a suffix, to build a specific PROD or LI\textbar{}BRARY\\
\verb|<name>_OBJLIBS_DEFAULT| & combined object files with filenames that do not have a suffix, needed to build a specific PROD or LIBRARY for archs with no \verb|<name>_OBJLIBS_<osclass>| specified\\
\verb|<name>_LDOBJS| & combined object files with filenames that do not have a suffix, needed to build a specific PROD or LIBRARY (deprecated)\\
\verb|<name>_LDOBJS_<osclass>| & os specific combined object files with filenames that do not have a suffix, to build a specific PROD or LI\textbar{}BRARY (deprecated)\\
\verb|<name>_LDOBJS_DEFAULT| & combined object files with filenames that do not have a suffix, needed to build a specific PROD or LIBRARY for archs with no \verb|<name>_LDOBJS_<osclass>| specified (deprecated)\\
\textbf{Product and library dependant libraries} & \\
\hline
\verb|<name>_DIR| & directory to search for the specified lib. (For libs listed in all \verb|PROD_LIBS|, \verb|LIB_LIBS|, \verb|<name>_LIBS| and \verb|USR_LIBS| listed below)System libraries do not need a \verb|<name>_dir| definition.\\
\verb|USR_LIBS| & load libraries (e.g. Xt X11) for all products and libraries\\
\verb|USR_LIBS_<osclass>| & os specific load libraries for all makefile links\\
\verb|USR_LIBS_DEFAULT| & load libraries for systems with no \verb|USR_LIBS_<osclass>| specified libs\\
\verb|<name>_LIBS| & named prod or library specific ld libraries (e.g. probe\_LIBS=X11 Xt)\\
\verb|<name>_LIBS_<osclass>| & os-specific libs needed to link named prod or library\\
\verb|<name>_LIBS_DEFAULT| & libs needed to link named prod or library for systems with no \verb|<name>_LIBS_<osclass>| specified\\
\verb|PROD_LIBS| & libs needed to link every PROD\\
\verb|PROD_LIBS_<osclass>| & os-specific libs needed to link every PROD\\
\verb|PROD_LIBS_DEFAULT| & libs needed to link every PROD for archs with no \verb|PROD_LIBS_<osclass>| specified\\
\verb|LIB_LIBS| & libraries to be linked with every library being created\\
\verb|LIB_LIBS_<osclass>| & os class specific libraries to be linked with every library being created\\
\verb|LIB_LIBS_DEFAULT| & libraries to be linked with every library being created for archs with no \verb|LIB_LIBS_<osclass>| specified\\
\verb|USR_SYS_LIBS| & system libraries (e.g. Xt X11) for all products and libraries\\
\verb|USR_SYS_LIBS_<osclass>| & os class specific system libraries for all makefile links\\
\verb|USR_SYS_LIBS_DEFAULT| & system libraries for archs with no \verb|USR_SYS_LIBS_<osclass>| specified\\
\verb|<name>_SYS_LIBS| & named prod or library specific system ld libraries\\
\verb|<name>_SYS_LIBS_<osclass>| & os class specific system libs needed to link named prod or library\\
\verb|<name>_SYS_LIBS_DEFAULT| & system libs needed to link named prod or library for systems with no \verb|<name>_SYS_LIBS_<osclass>| specified\\
\verb|PROD_SYS_LIBS| & system libs needed to link every PROD\\
\verb|PROD_SYS_LIBS_<osclass>| & os class specific system libs needed to link every PROD\\
\verb|PROD_SYS_LIBS_DEFAULT| & system libs needed to link every PROD for archs with no \verb|PROD_SYS_LIBS_<osclass>| specified\\
\verb|LIB_SYS_LIBS| & system libraries to be linked with every library being created\\
\verb|LIB_SYS_LIBS_<osclass>| & os class specific system libraries to be linked with every library being created\\
\verb|LIB_SYS_LIBS_DEFAULT| & system libraries to be linked with every library being created for archs with no \verb|LIB_SYS_LIBS_<osclass>| specified\\
\verb|SYS_PROD_LIBS| & system libs needed to link every PROD for all systems (deprecated)\\
\verb|SYS_PROD_LIBS_<osclass>| & os class specific system libs needed to link every PROD (deprecated)\\
\verb|SYS_PROD_LIBS_DEFAULT| & system libs needed to link every PROD for systems with no \verb|SYS_PROD_LIBS_<osclass>| specified (deprecated)\\
\textbf{Compiler flags} & \\
\hline
\verb|USR_CFLAGS| & C compiler flags for all systems\\
\verb|USR_CFLAGS_<T_A>| & target architecture specific C compiler flags\\
\verb|USR_CFLAGS_<osclass>| & os class specific C compiler flags\\
\verb|USR_CFLAGS_DEFAULT| & C compiler flags for archs with no \verb|USR_CFLAGS_<osclass>| specified\\
\verb|<name>_CFLAGS| & file specific C compiler flags (e.g. xxxRecord\_CFLAGS=-g)\\
\verb|<name>_CFLAGS_<T_A>| & file specific C compiler flags for a specific target architecture\\
\verb|<name>_CFLAGS_<osclass>| & file specific C compiler flags for a specific os class\\
\verb|USR_CXXFLAGS| & C++ compiler flags for all systems (e.g. xyxMain\_CFLAGS=-DSDDS)\\
\verb|USR_CXXFLAGS_<T_A>| & target architecture specific C++ compiler flags\\
\verb|USR_CXXFLAGS_<osclass>| & os-specific C++ compiler flags\\
\verb|USR_CXXFLAGS_DEFAULT| & C++ compiler flags for systems with no \verb|USR_CXXFLAGS_<osclass>| specified\\
\verb|<name>_CXXFLAGS| & file specific C++ compiler flags\\
\verb|<name>_CXXFLAGS_<T_A>| & file specific C++ compiler flags for a specific target architecture\\
\verb|<name>_CXXFLAGS_<osclass>| & file specific C++ compiler flags for a specific osclass\\
\verb|USR_CPPFLAGS| & C pre-processor flags (for all makefile compiles)\\
\verb|USR_CPPFLAGS_<T_A>| & target architecture specific cpp flags\\
\verb|USR_CPPFLAGS_<osclass>| & os specific cpp flags\\
\verb|USR_CPPFLAGS_DEFAULT| & cpp flags for systems with no \verb|USR_CPPFLAGS_<osclass>| specified\\
\verb|<name>_CPPFLAGS| & file specific C pre-processor flags(e.g. xxxRecord\_CPPFLAGS=-DDEBUG)\\
\verb|<name>_CPPFLAGS_<T_A>| & file specific cpp flags for a specific target architecture\\
\verb|<name>_CPPFLAGS_<osclass>| & file specific cpp flags for a specific os class\\
\verb|USR_INCLUDES| & directories, with -I prefix, to search for include files(e.g. -I\$(EPICS\_EXTENSIONS\_INCLUDE))\\
\verb|USR_INCLUDES_<osclass>| & directories, with -I prefix, to search for include files for a specific os class\\
\verb|USR_INCLUDES_DEFAULT| & directories, with -I prefix, to search for include files for systems with no \verb|<name>_INCLUDES_<osclass>| specified\\
\verb|<name>_INCLUDES| & directories, with -I prefix, to search for include files when building a specific object file (e.g. -I\$(MOTIF\_INC))\\
\verb|<name>_INCLUDES_<T_A>| & file specific directories, with -I prefix, to search for include files for a specific target architecture\\
\verb|<name>_INCLUDES_<osclass>| & file specific directories, with -I prefix, to search for include files for a specific os class\\
\verb|HOST_WARN| & Are compiler warning messages desired for host type builds? (YES or NO) (default is YES)\\
\verb|CROSS_WARN| & C cross-compiler warning messages desired (YES or NO) (default YES)\\
\verb|HOST_OPT| & Is host build compiler optimization desired (default is NO optimization)\\
\verb|CROSS_OPT| & Is cross-compiler optimization desired (YES or NO) (default is NO optimization)\\
\verb|CMPLR| & C compiler selection, TRAD, ANSI or STRICT (default is STRICT)\\
\verb|CXXCMPLR| & C++ compiler selection, NORMAL or STRICT (default is STRICT)\\
\textbf{Linker options} &    \\
\hline
\verb|USR_LDFLAGS| & linker options (for all makefile links)\\
\verb|USR_LDFLAGS_<osclass>| & os specific linker options (for all makefile links)\\
\verb|USR_LDFLAGS_DEFAULT| & linker options for systems with no \verb|USR_LDFLAGS_<osclass>| specified\\
\verb|PROD_LDFLAGS| & prod linker options\\
\verb|PROD_LDFLAGS_<osclass>| & os specific prod linker options\\
\verb|PROD_LDFLAGS_DEFAULT| & prod linker options for systems with no \verb|PROD_LDFLAGS_<osclass>| specified\\
\verb|LIB_LDFLAGS| & library linker options\\
\verb|LIB_LDFLAGS_<osclass>| & os specific library linker options\\
\verb|LIB_LDFLAGS_DEFAULT| & library linker options for systems with no \verb|LIB_LDFLAGS_<osclass>| specified\\
\verb|<name>_LDFLAGS| & prod or library specific linker options\\
\verb|<name>_LDFLAGS_<osclass>| & prod or library specific linker flags for a specific os class\\
\verb|<name>_LDFLAGS_DEFAULT| & linker options for systems with no \verb|<name>_LDFLAGS_<osclass>| specified\\
\verb|STATIC_BUILD| & Is static build desired (YES or NO) (default is NO). On win32 if STATIC\_BUILD=YES then set SHARED\_LIBRARIES=NO) \\
\textbf{Header files to be installed} &    \\
\hline
\verb|INC| & list of include files to install into \$(INSTALL\_DIR)/include\\
\verb|INC_<osclass>| & os specific includes to installed under \verb|$(INSTALL_DIR)/include/os/<osclass>|\\
\verb|INC_DEFAULT| & include files to install where no \verb|INC_<osclass>| is specified\\
\textbf{Perl, csh, tcl etc. script installation} &    \\
\hline
\verb|SCRIPTS| & scripts to install for all systems\\
\verb|SCRIPTS_<osclass>| & os-specific scripts to install\\
\verb|SCRIPTS_DEFAULT| & scripts to install for systems with no \verb|SCRIPTS_<osclass>| specified\\
\verb|SCRIPTS_IOC| & scripts to install for ioc type archs.\\
\verb|SCRIPTS_IOC_<osclass>| & os specific scripts to install for ioc type archs\\
\verb|SCRIPTS_IOC_DEFAULT| & scripts to install for ioc type arch systems with no \verb|SCRIPTS_IOC_<osclass>| specified\\
\verb|SCRIPTS_HOST| & scripts to install for host type archs. T\\
\verb|SCRIPTS_HOST_<osclass>| & os class specific scripts to install for host type archs\\
\verb|SCRIPTS_HOST_DEFAULT| & scripts to install for host type arch systems with no \verb|OBJS_HOST_<osclass>| specified\\
\verb|TCLLIBNAME| & list of tcl scripts to install into \verb|$(INSTALL_DIR)/lib/<osclass>| (Unix hosts only)\\
\verb|TCLINDEX| & name of tcl index file to create from TCLLIBNAME scripts\\
\textbf{Object files} & The names in the following OBJS definitions should NOT include a suffix (.o or.obj).\\
\hline
\verb|OBJS| & object files to build and install for all system. \\
\verb|OBJS_<osclass>| & os-specific object files to build and install. \\
\verb|OBJS_DEFAULT| & object files to build and install for systems with no \verb|OBJS_<osclass>| specified.\\
\verb|OBJS_IOC| & object files to build and install for ioc type archs.\\
\verb|OBJS_IOC_<osclass>| & os specific object files to build and install for ioc type archs\\
\verb|OBJS_IOC_DEFAULT| & object files to build and install for ioc type arch systems with no \verb|OBJS_IOC_<osclass>| specified\\
\verb|OBJS_HOST| & object files to build and install for host type archs. T\\
\verb|OBJS_HOST_<osclass>| & os class specific object files to build and install for host type archs\\
\verb|OBJS_HOST_DEFAULT| & object files to build and install for host type arch systems with no \verb|OBJS_HOST_<osclass>| specified\\
\textbf{Documentation} &    \\
\hline
\verb|DOCS| & text files to be installed into the \$(INSTALL\_DIR)/doc directory\\
\verb|HTMLS_DIR| & name install Hypertext directory name i.e. \$(INSTALL\_DIR)/html/\$(HTMLS\_DIR)\\
\verb|HTMLS| & hypertext files to be installed into the \$(INSTALL\_DIR)/html/\$(HTMLS\_DIR) directory\\
\verb|TEMPLATES_DIR| & template directory to be created as \$(INSTALL\_DIR)/templates/\$(TEMPLATE\_DIR)\\
\verb|TEMPLATES| & template files to be installed into \$(TEMPLATE\_DIR)\\
\textbf{Database Definition files} & \\
\hline
\verb|DBD| & database definition files to be installed or created and installed into \$(INSTALL\_DBD).\\
\verb|DBDINC| & names, without suffix, of menus or record database definitions and headers to be installed or created and installed. \\
\verb|USR_DBDFLAGS| & optional flags for dbExpand. Currently only include path (\verb|-I <path>|) and macro substitution (\verb|-S <substitution>|) are supported. \\
\verb|DBD_INSTALLS| & files from specified directory to install into \$(INSTALL\_DBD) (e.g. DBD\_INSTALLS = \$(APPNAME)/dbd/test.dbd\\
\textbf{Database Files} & \\
\hline
\verb|DB| & database files to be installed or created and installed into \$(INSTALL\_DB).\\
\verb|DB_INSTALLS| & files from specified directory to install into \$(INSTALL\_DB) (e.g. DB\_INSTALLS = \$(APPNAME)/db/test.db\\
\verb|USR_DBFLAGS| & optional flags for msi (EPICS Macro Substitution Tool)\\
\textbf{Options for other programs} &    \\
\hline
\verb|YACCOPT| & yacc options\\
\verb|LEXOPT| & lex options\\
\verb|SNCFLAGS| & state notation language, snc, options\\
\verb|<name>_SNCFLAGS| & product specific state notation language options\\
\verb|E2DB_FLAGS| & e2db options\\
\verb|SCH2EDIF_FLAGS| & sch2edif options\\
\verb|RANLIBFLAGS| & ranlib options\\
\verb|USR_ARFLAGS| & ar options\\
\textbf{Facilities for building Java programs} &    \\
\hline
\verb|JAVA| & names of Java source files to be built and installed\\
\verb|TESTJAVA| & names of Java source files to be built\\
\verb|JAVAINC| & names of C header file to be created in \verb|O.Common| subdirectory\\
\verb|JAR| & name of Jar file to be built\\
\verb|JAR_INPUT| & names of files to be included in JAR\\
\verb|JAR_MANIFEST| & name of manifest file for JAR\\
\verb|USR_JAVACFLAGS| & javac tool options\\
\verb|USR_JAVAHFLAGS| & javah tool options\\
\textbf{Facilities for Windows 95/NT resource ( .rc) files} &    \\
\hline
\verb|RCS| & resource files (\verb|<name>.rc|) needed to build every PROD and LIBRARY\\
\verb|RCS_<osclass>| & resource files (\verb|<name>.rc|) needed to build every PROD and LIBRARY for ioc type archs\\
\verb|RCS_DEFAULT| & resource files needed to build every PROD and LIBRARY for ioc type arch systems with no \verb|RCS_<osclass>| specified\\
\verb|<name>_RCS| & resource files needed to build a specific PROD or LIBRARY\\
\verb|<name>_RCS_<osclass>| & os specific resource files to build a specific PROD or LIBRARY\\
\verb|<name>_RCS_DEFAULT| & resource files needed to build a specific PROD or LIBRARY for ioc type arch systems with no \verb|RCS_<osclass>| specified\\
\textbf{Assemblies} &    \\
\hline
\verb|ASSEMBLIES| & names of files to be assembled from snippets\\
\verb|COMMON_ASSEMBLIES| & names of arch-independent files to be assembled from snippets\\
\verb|<name>_SNIPPETS| & snippet files needed to build a specific assembly\\
\verb|<name>_PATTERN| & patterns for snippet files (searched from all source directories) needed to build a specific assembly\\
\textbf{Other definitions: } &    \\
\hline
\verb|USR_VPATH| & list of directories\\
\verb|BIN_INSTALLS| & files from specified directories to be installed into \$(INSTALL\_BIN) (e.g. BIN\_INSTALLS = \$(EPICS\_BASE\_BIN)/aiRecord\$(OBJ))\\
\verb|BIN_INSTALLS_<osclass>| & os class specific files from specified directories to be installed into \$(INSTALL\_BIN)\\
\verb|BIN_INSTALLS_DEFAULT| & files from specified directories to be installed into \$(INSTALL\_BIN) for target archs with no \verb|BIN_INSTALLS_<osclass>| specified\\
\verb|LIB_INSTALLS| & files from specified directories to be installed into \$(INSTALL\_LIB)\\
\verb|LIB_INSTALLS_<osclass>| & os class specific files from specified directories to be installed into \$(INSTALL\_LIB)\\
\verb|LIB_INSTALLS_DEFAULT| & files from specified directories to be installed into \$(INSTALL\_LIB) for target archs with no \verb|LIB_INSTALLS_<osclass>| specified\\
\verb|TARGETS| & files to create but not install\\
\verb|INSTALL_LOCATION| & installation directory (defaults to \$(TOP))\\
\verb|GENVERSION| & If set, the name of a generated header file with the module version string.\\
\verb|GENVERSIONMACRO| & The CPP macro name written into the generated version header (default \verb|MODULEVERSION|).\\
\verb|GENVERSIONDEFAULT| & The default version string written into the generated header if no VCS system is in use. Leave unset to use build time.\\
\end{longtable}

\end{center}


\section{Configuration Files}

\subsection{Base Configure Directory}

The base/configure directory has the following directory structure:

\begin{verbatim}
base/
   configure/
      os/
      tools/
\end{verbatim}

\subsection{Base Configure File Descriptions}

\index{Configure files}
The configure files contain definitions and make rules to be included in the various makefiles.

\begin{description}

\item \index{CONFIG.CrossCommon}\verb|CONFIG.CrossCommon|

Definitions for all hosts and all targets for a cross build (host different than target).

\item \index{CONFIG.gnuCommon}\verb|CONFIG.gnuCommon|

Definitions for all hosts and all targets for builds using the gnu compiler.

\item \index{CONFIG\_ADDONS}\verb|CONFIG_ADDONS|

Definitions which setup the variables that have \verb|<osclass>| and DEFAULT options.

\item \index{CONFIG\_APP\_INCLUDE}\verb|CONFIG_APP_INCLUDE|

Definitions to generate include, bin, lib, perl module, db, and dbd directory definitions for RELEASE \verb|<top>|s.

\item \index{CONFIG\_BASE}\verb|CONFIG_BASE|

EPICS base specific definitions.

\item \index{CONFIG\_BASE\_VERSION}\verb|CONFIG_BASE_VERSION|

Definitions for the version number of EPICS base. This file is used for creating epicsVersion.h which is installed 
into base/include.

\item \index{CONFIG\_COMMON}\verb|CONFIG_COMMON|

Definitions common to all builds.

\item \index{CONFIG\_ENV}\verb|CONFIG_ENV|

Default definitions of the EPICS environment variables. This file is used for creating envData.c which is included 
in the Com library.

\item \index{CONFIG\_FILE\_TYPE}\verb|CONFIG_FILE_TYPE|

Definitions to allow user created file types.

\item \index{CONFIG\_SITE}\verb|CONFIG_SITE|

File in which you add to or modify make variables in EPICS base. A definition commonly overridden is \verb|CROSS_COMPILER_TARGET_ARCHS|

\item \index{CONFIG\_SITE\_ENV}\verb|CONFIG_SITE_ENV|

Defaults for site specific definitions of EPICS environment variables. This file is used for creating envData.c 
which is included in the Com library.

\item \index{CONFIG}\verb|CONFIG|

Include statements for all the other configure files. You can \index{override}override any definitions in other CONFIG* files by 
placing override definitions at the end of this file.

\item \index{RELEASE}\verb|RELEASE|

Specifies the location of external products such as Tornado II and external \verb|<tops>| such as EPICS base. 

\item \index{RULES}\verb|RULES|

This file just includes the appropriate rules configuration file.

\item \index{RULES.Db}\verb|RULES.Db|

Rules for building and installing database and database definition files. Databases generated from templates and/or 
CapFast schematics are supported.

\item \index{RULES.ioc}\verb|RULES.ioc|

Rules which allow building in the \verb|iocBoot/<iocname>| directory of a makeBaseApp created ioc application.

\item \index{RULES\_ARCHS}\verb|RULES_ARCHS|

Definitions and rules which allow building the make target for each target architecture.

\item \index{RULES\_BUILD}\verb|RULES_BUILD|

Build rules for the Makefiles 

\item \index{RULES\_DIRS}\verb|RULES_DIRS|

Definitions and rules which allow building the make targets in each subdirectory. This file is included by Makefiles 
in directories with subdirectories to be built.

\item \index{RULES\_EXPAND}\verb|RULES_EXPAND|

Definitions and rules to use \index{expandVars.pl}expandVars.pl to expand @VAR@ variables in a file.

\item \index{RULES\_FILE\_TYPE}\verb|RULES_FILE_TYPE|

Definitions and rules to allow user created CONFIG* and RULES* files and rules to allow user created file types.

\item \index{RULES\_JAVA}\verb|RULES_JAVA| 
Definitions and rules which allow building java class files and java jar files.

\item \index{RULES\_TARGET}\verb|RULES_TARGET|

Makefile code to create target specific dependency lines for libraries and product targets.

\item \index{RULES\_TOP}\verb|RULES_TOP|

Rules specific to a \verb|<top>| level directory e.g. uninstall and tar. It also includes the RULES\_DIRS file.

\item \index{Makefile}\verb|Makefile|
Definitions to allow creation of \verb|CONFIG_APP_INCLUDE| and installation of the CONFIG* files into the 
\verb|$(INSTALL_LOCATION)| directory.

\end{description}

\subsection{Base configure/os File Descriptions}

\index{configure/os File}
The configure/os directory contains os specific make definitions. The naming convention for the files in this directory is 
\verb|CONFIG.<host>.<target>| where \verb|<host>| is either the arch for a specific host system or \verb|Common| for all supported host 
systems and \verb|<target>| is either the arch for a specific target system or Common for all supported target systems. 

For example, the file CONFIG.Common.vxWorks-pentium will contain make definitions to be used for builds on all host 
systems when building for a vxWorks-pentium target system.

Also, if a group of host or target files have the same make definitions these common definitions can be moved to a new 
file which is then included in each host or target file. An example of this is all Unix hosts which have common definitions 
in a CONFIG.UnixCommon.Common file and all vxWorks targets with definitions in 
CONFIG.Common.vxWorksCommon.

The base/configure/os directory contains the following os-arch specific definitions

\begin{description}

\item \index{CONFIG.host.target}\verb|CONFIG.<host>.<target>|

Specific host-target build definitions

\item \index{CONFIG.Common.target}\verb|CONFIG.Common.<target>|

Specific target definitions for all hosts

\item \index{CONFIG.host.Common}\verb|CONFIG.<host>.Common|

Specific host definitions for all targets

\item \index{CONFIG.UnixCommon.Common}\verb|CONFIG.UnixCommon.Common|

Definitions for Unix hosts and all targets

\item \index{CONFIG.host.vxWorksCommon}\verb|CONFIG.<host>.vxWorksCommon|

Specific host definitions for all vx targets

\item \index{CONFIG\_COMPAT}\verb|CONFIG_COMPAT|

R3.13 arch compatibility definitions

\item \index{CONFIG\_SITE.host.target}\verb|CONFIG_SITE.<host>.<target>|

Site specific host-target definitions

\item \index{CONFIG\_SITE.Common.target}\verb|CONFIG_SITE.Common.<target>|

Site specific target definitions for all hosts

\item \index{CONFIG\_SITE.host.Common}\verb|CONFIG_SITE.<host>.Common|

Site specific host definitions for all targets

\end{description}

\subsection{Base src/tools File Descriptions}

\index{src/tools File}
The src/tools directory contains Perl script tools used for the build. The are installed by the build into \\
\verb|$(INSTALL_LOCATION)/bin/$(T_A)| for Host type target archs. The tools currently in this directory are:

\begin{description}

\item[convertRelease.pl]
\index{installEpics.pl}

This Perl script does consistency checks for the external \verb|<top>| definitions in the RELEASE file. This script also creates envPaths, cdCommands, and dllPath.bat files for vxWorks and other IOCs.

\item[cvsclean.pl]
\index{cvsclean.pl}

This perl script finds and deletes cvs .\#* files in all directories of the directory tree.

\item[dos2unix.pl]
\index{dos2unix.pl}

This perl script converts text file in DOS CR/LF format to unix ISO format.

\item[expandVars.pl]
\index{expandVars.pl}

This perl tool expands \verb|@VAR@| variables while copying a file.

\item[filterWarnings.pl]
\index{filterWarnings.pl}

This is a perl script that filters compiler warning output (for HP-UX).

\item[fullpathname.pl]
\index{fullpathname.pl}

This perl script returns the fullpathname of a file.

\item[installEpics.pl]
\index{installEpics.pl}

This is a Perl script that installs build created files into the install directories.

\item[makeDbDepends.pl]
\index{makeDbDepends.pl}

This perl script searches .substitutions and .template files for entries to create a DEPENDS file.

\item[makeIncludeDbd.pl]
\index{makeIncludeDbd.pl}

This perl script creates an include dbd file from file names

\item[makeMakefile.pl]
\index{makeMakefile.pl}

This is a perl script that creates a Makefile in the created \verb|O.<arch>| directories.

\item[makeTestfile.pl]
\index{makeTestfile.pl}

This perl script generates a file \$target.t which executes a real test program in the same directory.

\item[mkmf.pl]
\index{mkmf.pl}

This perl script generates include file dependencies for targets from source file include statements.

\item[munch.pl]
\index{munch.pl}

This is a perl script that creates a ctdt.c file for vxWorks target arch builds which lists the c++ static constructors 
and destructors. See munching in the vxWorks documentation for more information.

\item[replaceVAR.pl]
\index{replaceVAR.pl}

This is a perl script that changes VAR(xxx) style macros in CapFast generated databases into the \$(xxx) notation 
used in EPICS databases.

\item[useManifestTool.pl]
\index{useManifestTool.pl}

This tools uses MS Visual C++ compiler version number to determine if we want to use the Manifest Tool 
(status=1) or not (status=0).

\end{description}

\section{Build Documentation Files}

\subsection{Base Documentation Directory}

\index{Documentation Directory}
The base/documentation directory contains README files to help users setup and build epics/base.

\subsection{Base Documentation File Descriptions}

\index{Documentation Files}
The files currently in the base/documentation directory are:

\begin{description}

\item[README.1st]
\index{README.1st}

Instructions for setup and building epics base

\item[README.html]
\index{README.html}

html version of README.1st

\item[README.MS\_WINDOWS]
\index{README.MS\_WINDOWS}

Microsoft WIN32 specific instructions

\item[README.niCpu030]
\index{README.niCpu030}

NI cpu030 specific instructions

\item[README.hpux]
\index{README.hpux}

\index{hpux}
HPUX 11 (hpux-parisc) specific instructions

\item[README.cris]
\index{README.cris}

Cris architecture specific instructions

\item[README.tru64unix]
\index{README.tru64unix}

Tru64Unix/Alpha specific instructions

\item[README.darwin.html]
\index{README.darwin.html}

Installation notes for Mac OS X (Darwin)

\item[BuildingR3.13AppsWithR3.14.html]
\index{BuildingR3.13AppsWithR3.14.html}

Describes how to modify a R3.13 vxWorks application so that it builds with release R3.14.1.

\item[ConvertingR3.13AppsToR3.14.html]
\index{ConvertingR3.13AppsToR3.14.html}

Describes how to convert a R3.13 vxWorks application so that it contains a R3.14 configure directory and R3.14 
Makefiles and builds with R3.14.1.

\item[ConvertingR3.14.0alpha2AppsTobeta1.html]

Describes how to modify a R3.14.0alpha1 application so that it builds with release R3.14.0beta1.

\item[ConvertingR3.14.0beta1AppsTobeta2.html]

Describes how to modify a R3.14.0beta1 application so that it builds with release R3.14.0beta2.

\item[ConvertingR3.14.0beta2AppsToR3.14.1.html]

Describes how to modify a R3.14.0beta2 application so that it builds with release R3.14.1.

\item[ConvertingR3.14.*AppsToR3.14.*.html]

Describes how to modify a R3.14.* application so that it builds with next release after R3.14.*.

\item[BuildingR3.13ExtensionsWithR3.14.html]
\index{BuildingR3.13ExtensionsWithR3.14.html}

Describes how to modify a R3.13 extension so that it builds with release R3.14.1.

\item[RELEASE\_NOTES.html]
\index{RELEASE\_NOTES.html}

Describes changes in the R3.14.1 release

\item[KnownProblems.html]
\index{KnownProblems.html}

List of known problems in EPICS base R3.14.1.

\item[ReleaseChecklist.html]
\index{ReleaseChecklist.html}

Checklist of things that must be done when creating a new release of EPICS Base.

\end{description}

\section{Startup Files}

\index{Startup Files}

\subsection{Base Startup Directory}

The base/startup directory contains scripts to help users set the required environment variables and path. The appropriate 
startup files should be executed before any EPICS builds.

\subsection{Base Startup File Descriptions}

\index{Startup File Descriptions}
The scripts currently in the base/startup directory are:

\begin{description}

\item[EpicsHostArch]
\index{EpicsHostArch}

c shell script to set EPICS\_HOST\_ARCH environment variable

\item[EpicsHostArch.pl]
\index{EpicsHostArch.pl}

perl script to set EPICS\_HOST\_ARCH environment variable

\item[Site.profile]
\index{Site.profile}

Unix bourne shell script to set path and environment variables

\item[Site.cshrc]
\index{Site.cshrc}

Unix c shell script to set path and environment variables

\item[cygwin.bat]
\index{cygwin.bat}

WIN32 bat file to set path and environment variables for building with cygwin gcc/g++ compilers

\item[win32.bat]
\index{win32.bat}

WIN32 bat file to set path and environment variables for building with MS Visual C++ compilers

\end{description}








